This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repopack on: 2025-01-24T01:16:18.441Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repopack's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

Additional Info:
----------------

For more information about Repopack, visit: https://github.com/yamadashy/repopack

================================================================
Repository Structure
================================================================
app/
  Console/
    Commands/
      CrawlPlcDataCommand.php
      MasterDataSync.php
      RecruitmentSync.php
    Kernel.php
  Exports/
    AccountExport.php
    ExportCandidate.php
  Http/
    Controllers/
      Auth/
        AuthController.php
      Plc/
        ChartController.php
        MachineController.php
        MachineThresholdController.php
        PlcController.php
      Controller.php
    Middleware/
      Admin.php
      Authenticate.php
      CkfinderAuthentication.php
      EncryptCookies.php
      Personnel.php
      PreventRequestsDuringMaintenance.php
      RedirectIfAuthenticated.php
      TrimStrings.php
      TrustHosts.php
      TrustProxies.php
      UnisharpAuthentication.php
      ValidateSignature.php
      VerifyCsrfToken.php
    Kernel.php
  Jobs/
    SendHtmlEmailJob.php
    SyncDepartmentToOtherDb.php
    SyncPositionToOtherDb.php
    SyncUserToOtherDb.php
  Models/
    Machine.php
    MachineThreshold.php
    PlcData.php
    User.php
  Providers/
    AppServiceProvider.php
    AuthServiceProvider.php
    BroadcastServiceProvider.php
    EventServiceProvider.php
    RouteServiceProvider.php
  Repositories/
    Plc/
      MachineRepository.php
      MachineThresholdRepository.php
    Support/
      AbstractRepository.php
      Exceptions.php
  Services/
    PlcDataService.php
resources/
  views/
    auth/
      login.blade.php
    plc/
      chart/
        show.blade.php
      layouts/
        _footer_content.blade.php
        _footer.blade.php
        _head.blade.php
        _header.blade.php
        _navbar.blade.php
        _sidebar.blade.php
        master_candidate.blade.php
        master_content.blade.php
        master.blade.php
      machine/
        create.blade.php
        edit.blade.php
        index.blade.php
      machine_threshold/
        create.blade.php
        edit.blade.php
        index.blade.php
        show.blade.php
      index.blade.php
routes/
  plc/
    admin.php
  admin.php
  api.php
  channels.php
  console.php
  frontend.php
  web.php

================================================================
Repository Files
================================================================

================
File: app/Console/Commands/CrawlPlcDataCommand.php
================
<?php

namespace App\Console\Commands;

use App\Models\Machine;
use App\Services\PlcDataService;
use Illuminate\Console\Command;

class CrawlPlcDataCommand extends Command
{
    protected $signature = 'plc:crawl {--interval=5 : Thời gian giữa các lần crawl (giây)}';
    protected $description = 'Crawl dữ liệu từ PLC web interface';

    protected $plcDataService;

    public function __construct(PlcDataService $plcDataService)
    {
        parent::__construct();
        $this->plcDataService = $plcDataService;
    }

  public function handle()
    {
        $interval = $this->option('interval');
        $this->info('Bắt đầu lấy dữ liệu');

        while(true) {
            try {
                // Lấy tất cả máy đang active
                $machines = Machine::where('status', true)->get();

                foreach($machines as $machine) {
                    $data = $this->plcDataService->crawlData($machine->id);

                    if ($data) {
                        $this->info("\nLưu dữ liệu máy {$machine->name} (ID: {$data->id}):");

                        // Hiển thị các thông số quan trọng
                        $this->table(
                            ['Thông số', 'Giá trị'],
                            [
                                ['Ca', $data->ca],
                                ['Nhiệt độ nhựa', $data->nhiet_do_nhua],
                                ['Áp lực nhựa', $data->ap_luc_nhua],
                                ['Năng suất', $data->nang_suat],
                                ['Tốc độ VX', $data->toc_do_vx],
                                ['Tốc độ máy chỉ', $data->toc_do_may_chi],
                                ['Nhiệt độ nước vacuum 1', $data->nhiet_do_nuoc_vacuum_1],
                                ['Nhiệt độ nước vacuum 2', $data->nhiet_do_nuoc_vacuum_2]
                            ]
                        );
                    } else {
                        $this->error("Không thể lấy dữ liệu từ máy {$machine->name}");
                    }
                }

            } catch (\Exception $e) {
                $this->error('Lỗi: ' . $e->getMessage());
            }

            if ($interval > 0) {
                $this->info("\nĐợi {$interval} giây...");
                sleep($interval);
            } else {
                break;
            }
        }
    }
}

================
File: app/Console/Commands/MasterDataSync.php
================
<?php

namespace App\Console\Commands;

use App\Models\Position;
use App\Models\Candidate;
use App\Models\RequestForm;
use App\Models\RecruitmentNeed;
use Illuminate\Console\Command;
use Illuminate\Support\Facades\DB;

class MasterDataSync extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'app:masterdata-sync';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Đồng bộ master data theo ngày';

    /**
     * Execute the console command.
     */
    public function handle()
    {
        $dbs = ['sangkien'];
        foreach($dbs as $db)
        {

        }

        $this->syncUser();
        $this->syncPosition();
        $this->syncDepartment();
        $this->info('Đồng bộ dữ liệu kế hoạch tuyển dụng thành công');
    }

    private function syncUser()
    {

    }

    private function syncPosition()
    {

    }

    private function syncDepartment($db)
    {
        DB::connection($db)->table('department')->updateOrInsert(
            [
                'name' => $this->department->code,
            ],
            [
                'name' => $this->department->code,
                'display_name' => $this->department->name,
                //'head_of_department' => $this->department->manager_by,
            ]
        );
    }
}

================
File: app/Console/Commands/RecruitmentSync.php
================
<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use App\Models\Candidate;
use App\Models\Position;
use App\Models\RecruitmentNeed;
use App\Models\RequestForm;

class RecruitmentSync extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'app:recruitment-sync';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Đồng bộ dữ liệu kế hoạch tuyển dụng theo tháng';

    /**
     * Execute the console command.
     */
    public function handle()
    {
        $startYear = 2018; // Khởi đầu từ tháng 1 năm 2018
        $startMonth = 1;
        $endYear = now()->year;
        $endMonth = now()->month;

        // Lặp qua các năm từ 2018 đến hiện tại
        for ($year = $startYear; $year <= $endYear; $year++) {
            // Lặp qua từng tháng trong năm
            for ($month = $startMonth; $month <= ($year < $endYear ? 12 : $endMonth); $month++) {
                foreach (Position::all() as $position) {
                    $this->processPositionForMonthYear($position, $month, $year); // Đồng bộ lại dữ liệu theo tháng/năm/vị trí
                }
            }
            $startMonth = 1; // Bắt đầu từ tháng 1 nếu qua năm mới
        }

        $this->info('Đồng bộ dữ liệu kế hoạch tuyển dụng thành công');
    }

    private function processPositionForMonthYear($position, $month, $year)
    {
        $position_id = $position->id;

        // Tính nhau cầu phát sinh
        $more = $this->calculateMore($position_id, $month, $year);

        // Tính số lượng đã tuyển
        $recruitmented = $this->calculateRecruited($position_id, $month, $year);

        // Tính nhu cầu đầu kì
        $need = $this->calculateNeed($position_id, $month, $year);

        // Giảm trừ
        $sub = $this->calculateSub($position->id, $month, $year);
        $totalNeed = $need + $more - $recruitmented - $sub;

        $recruitmentNeed = RecruitmentNeed::firstOrCreate(
            ['position_id' => $position_id, 'time' => "$year-$month-01"],
            ['need' => $need, 'more' => $more, 'recruitmented' => $recruitmented, 'total' => $totalNeed, 'active' => true]
        );

        $isNewRecord = $recruitmentNeed->wasRecentlyCreated;

        if (
            !$isNewRecord &&
            ($recruitmentNeed->need !== $need ||
                $recruitmentNeed->more !== $more ||
                $recruitmentNeed->recruitmented !== $recruitmented ||
                $recruitmentNeed->sub !== $sub ||
                $recruitmentNeed->total !== $totalNeed)
        ) {
            $recruitmentNeed->update([
                'need' => $need,
                'more' => $more,
                'recruitmented' => $recruitmented,
                'sub' => $sub,
                'total' => $totalNeed,
            ]);
        }
    }

    private function calculateMore($position_id, $month, $year)
    {
        return RequestForm::whereYear('request_date', $year)
            ->whereMonth('request_date', $month)
            ->whereNotIn('status', ['plan', 'cancel'])
            ->where('position_id', $position_id)
            ->sum('quantity') ?? 0;
    }

    private function calculateSub($position_id, $month, $year)
    {
        return RequestForm::whereYear('request_date', $year)
            ->whereMonth('request_date', $month)
            ->where('position_id', $position_id)
            ->sum('sub') ?? 0;
    }

    // private function calculateRecruited($position_id, $month, $year)
    // {
    //     return Candidate::whereYear('probation_to', $year)
    //         ->whereMonth('probation_to', $month)

    //         ->where('position_id', $position_id)
    //         ->whereIn('status', ['recruitment_success', 'probation_success', 'probation_fail', 'probation_long', 'employee'])
    //         ->count();
    // }

//    private function calculateRecruited($position_id, $month, $year)
// {
//     return Candidate::where(function ($query) use ($year, $month) {
//         $query->where(function ($query) use ($year, $month) {
//             $query->whereYear('probation_from', $year)
//                   ->whereMonth('probation_from', $month)
//                   ->where('status', 'recruitment_success');
//         })
//         ->orWhere(function ($query) use ($year, $month) {
//             $query->whereYear('probation_to', $year)
//                   ->whereMonth('probation_to', $month)
//                   ->whereIn('status', ['probation_success', 'probation_fail', 'employee']);
//         });
//     })
//     ->where('position_id', $position_id)
//     ->count();
// }

    private function calculateRecruited($position_id, $month, $year)
    {
        return Candidate::where(function ($query) use ($year, $month) {
            $query->where(function ($query) use ($year, $month) {
                $query->whereYear('probation_from', $year)
                    ->whereMonth('probation_from', $month)
                    ->where('status', 'recruitment_success');
            })
                ->orWhere(function ($query) use ($year, $month) {
                    $query->whereYear('probation_to', $year)
                        ->whereMonth('probation_to', $month)
                        ->whereIn('status', ['probation_success', 'probation_fail', 'employee']);
                });
        })
            ->where('position_id', $position_id)
            ->count();
    }


    private function calculateNeed($position_id, $month, $year)
    {
        if ($month == 1) {
            $prevMonth = 12;
            $prevYear = $year - 1;
        } else {
            $prevMonth = $month - 1;
            $prevYear = $year;
        }

        $previousNeed = RecruitmentNeed::whereYear('time', $prevYear)
            ->whereMonth('time', $prevMonth)
            ->where('position_id', $position_id)
            ->first();

        return $previousNeed ? ($previousNeed->need + $previousNeed->more - $previousNeed->recruitmented - $previousNeed->sub) : 0;
    }
}

================
File: app/Console/Kernel.php
================
<?php

namespace App\Console;

use Illuminate\Console\Scheduling\Schedule;
use Illuminate\Foundation\Console\Kernel as ConsoleKernel;

class Kernel extends ConsoleKernel
{
    protected $commands = [
        Commands\RecruitmentSync::class,
    ];
    /**
     * Define the application's command schedule.
     */
    protected function schedule(Schedule $schedule): void
    {
        $schedule->command('app:recruitment-sync')->withoutOverlapping()->everyMinute()->onFailure(function ($exception) {
            \Log::error('Lỗi xảy ra khi chạy lệnh: ' . $exception->getMessage());
            \Log::error('Stack Trace: ' . $exception->getTraceAsString());
        });
    }

    /**
     * Register the commands for the application.
     */
    protected function commands(): void
    {

        $this->load(__DIR__.'/Commands');

        require base_path('routes/console.php');
    }



}

================
File: app/Exports/AccountExport.php
================
<?php

namespace App\Exports;

use App\Models\Account;
use Maatwebsite\Excel\Concerns\FromCollection;

class AccountExport implements FromCollection
{
    public function __construct(int $id) {
    	$this->id = $id;
    }
    /**
    * @return \Illuminate\Support\Collection
    */
    // public function collection()
    // {
    //     return Account::all();
    // }

    public function collection()
    {
        return ClassSubject::findOrFail($this->id);
    }

    //Tiêu đề cho bảng
    public function headings() :array {
    	return ["STT", "Tên tài khoản", "Mật khẩu", "Trạng thái"];
    }

    //Xuất dựa trên blade view
    public function view(): View
    {
        return view('exports.users', [
            'users' => User::all()
        ]);
    }
}

================
File: app/Exports/ExportCandidate.php
================
<?php

namespace App\Exports;

use Maatwebsite\Excel\Concerns\FromCollection;
use Maatwebsite\Excel\Concerns\WithHeadings;

class ExportCandidate implements FromCollection, WithHeadings
{
    protected $data;
    /**
    * @return \Illuminate\Support\Collection
    */
    public function __construct($data)
    {
        $this->data = $data;
    }

    public function collection()
    {
        return collect($this->data);
    }

    public function headings(): array
    {
        return [
            'Họ tên',
            'Ngày sinh',
            'Trạng thái',
            'Vị trí',
            'Phòng ban',
            'Thời gian nhận hồ sơ',
            'Người nhận hồ sợ',
            'Nguồn tuyển dụng',
            'Ghi chú mối quan hệ',
            'Giới tính',
            'Số điện thoại',
            'Email',
            'Hộ khẩu',
            'Địa chỉ',
            'Địa chỉ chi tiết',
            'Quá trình đào tạo',
            'Kinh nghiệm làm việc',
            'Ngoại ngữ',
            'Phần mềm đặc thù',
            'Thông tin tham chiếu',
            'Ngày SLHS',
            'Người SLHS',
            'Nhận xét SLHS',
            'Kết quả SLHS',
            'Ngày PVSB',
            'Người PVSB',
            'Nhận xét PVSB',
            'Kết quả PVSB',
            'Ngày PVV1',
            'Người PVV1',
            'Nhận xét PVV1',
            'Kết quả PVV1',
            'Ngày PVV2',
            'Người PVV2',
            'Nhận xét PVV2',
            'Kết quả PVV2',
            'Ngày PVV3',
            'Người PVV3',
            'Nhận xét PVV3',
            'Kết quả PVV3',
            'Kết quả nhận việc',
            'Thử việc từ',
            'Thử việc tới',
            'Kết quả thử việc',
        ];
    }
}

================
File: app/Http/Controllers/Auth/AuthController.php
================
<?php

namespace App\Http\Controllers\Auth;

use App\Common\Traits\ApiResponses;
use App\Http\Controllers\Controller;
use App\Models\User;
use Hash;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Session;

class AuthController extends Controller
{

    use ApiResponses;
    public function index()
    {
        return view('auth.login');
    }

    public function getAuthData()
    {
        try {
            return $this->success(Auth::user());
        } catch (\Exception $ex) {
            return $this->error($ex->getMessage());
        }
    }

    public function getLogin()
    {
        return view('auth.login');
    }

    public function login(Request $request)
    {
        $request->validate([
            'code' => 'required|max:32',
            'password' => 'required|min:6|max:32',
        ]);


        if (Auth::attempt(['code' => $request->code, 'password' => $request->password, 'active' => 1])) {
            return redirect()->route('module.index');
        }

        return redirect()->back()->with('error', 'Sai thông tin đăng nhập hoặc tài khoản này đã bị vô hiệu');
    }



    public function registration()
    {
        return view('auth.registration');
    }


    public function customRegistration(Request $request)
    {
        $request->validate([
            'name' => 'required',
            'email' => 'required|email|unique:users',
            'password' => 'required|min:6',
        ]);

        $data = $request->all();
        $check = $this->create($data);

        return redirect("dashboard")->withSuccess('You have signed-in');
    }


    public function create(array $data)
    {
        return User::create([
            'name' => $data['name'],
            'email' => $data['email'],
            'password' => Hash::make($data['password'])
        ]);
    }

    public function logout()
    {
        Session::flush();
        Auth::logout();

        return Redirect('login');
    }
}

================
File: app/Http/Controllers/Plc/ChartController.php
================
<?php

namespace App\Http\Controllers\Plc;

use App\Http\Controllers\Controller;
use App\Models\Machine;
use App\Models\PlcData;
use App\Models\MachineThreshold;
use Carbon\Carbon;
use Illuminate\Http\Request;

class ChartController extends Controller
{
    public function show($machineId)
    {
        $machine = Machine::findOrFail($machineId);

        // Lấy các thông số được chọn hiển thị trên biểu đồ
        $thresholds = MachineThreshold::where('machine_id', $machineId)
            ->where('show_on_chart', true)
            ->get();

        // Tạo cấu hình series cho từng thông số
        $series = $thresholds->map(function($threshold) {
            return [
                'name' => $threshold->name,
                'valueField' => $threshold->plc_data_key,
                'color' => $this->getSeriesColor($threshold->plc_data_key),
            ];
        });

        return view('plc.chart.show', compact('machine', 'series'));
    }

   public function getData($machineId, Request $request)
{
    $range = $request->get('range', '24h');
    $endDate = Carbon::now();

    switch($range) {
        case '7d':
            $startDate = Carbon::now()->subDays(7);
            break;
        case '30d':
            $startDate = Carbon::now()->subDays(30);
            break;
        default: // 24h
            $startDate = Carbon::now()->subDay();
    }

    // Lấy danh sách các thông số được chọn hiển thị trên biểu đồ
    $thresholds = MachineThreshold::where('machine_id', $machineId)
        ->where('show_on_chart', true)
        ->get();

    // Query dữ liệu chi tiết
    $query = PlcData::where('machine_id', $machineId)
        ->whereBetween('created_at', [$startDate, $endDate])
        ->select([
            'created_at as timestamp',
            'toc_do_vx',
            'toc_do_may_chi',
            'nhiet_do_xl_2',
            'nhiet_do_xl_4',
            'nhiet_do_nhua',
            'ap_luc_nhua',
            'nang_suat'
        ])
        ->orderBy('timestamp');

    // Hoặc dùng dynamic select nếu cần
    /*
    $query = PlcData::where('machine_id', $machineId)
        ->whereBetween('created_at', [$startDate, $endDate])
        ->select('created_at as timestamp');

    foreach($thresholds as $threshold) {
        $query->addSelect($threshold->plc_data_key);
    }
    $query->orderBy('timestamp');
    */

    $data = $query->get();

    // Thêm thông tin ngưỡng cảnh báo vào response
    $thresholdLimits = $thresholds->mapWithKeys(function($threshold) {
        return [$threshold->plc_data_key => [
            'min' => $threshold->min_value,
            'max' => $threshold->max_value,
            'warning_min' => $threshold->warning_min_value,
            'warning_max' => $threshold->warning_max_value,
            'name' => $threshold->name
        ]];
    });

    return response()->json([
        'success' => true,
        'data' => $data,
        'thresholds' => $thresholdLimits
    ]);
}

    private function getSeriesColor($field)
    {
        // Map màu sắc cho các loại dữ liệu
        $colorMap = [
            'toc_do_vx' => '#00FF00',
            'nhiet_do_xl_2' => '#FFA500',
            'nhiet_do_xl_4' => '#FF0000',
            'nhiet_do_nhua' => '#0000FF',
            'ap_luc_nhua' => '#800080'
        ];

        return $colorMap[$field] ?? '#666666';
    }
}

================
File: app/Http/Controllers/Plc/MachineController.php
================
<?php

namespace App\Http\Controllers\Plc;

use App\Http\Controllers\Controller;
use App\Repositories\Plc\MachineRepository;
use Illuminate\Http\Request;

class MachineController extends Controller
{
    protected $repository;

    public function __construct(MachineRepository $repository)
    {
        $this->repository = $repository;
    }

    public function index()
    {
        $machines = $this->repository->paginate();
        return view('plc.machine.index', compact('machines'));
    }

    public function create()
    {
        return view('plc.machine.create');
    }

    public function store(Request $request)
    {
        $data = $request->validate($this->repository->validateCreate());
        $this->repository->create($data);
        return redirect()->route('plc.machine.index')
            ->with('success', 'Thêm máy thành công!');
    }

    public function edit($id)
    {
        $machine = $this->repository->find($id);
        return view('plc.machine.edit', compact('machine'));
    }

    public function update(Request $request, $id)
    {
        $data = $request->validate($this->repository->validateUpdate($id));
        $this->repository->update($data, $id);
        return redirect()->route('plc.machine.index')
            ->with('success', 'Cập nhật máy thành công!');
    }

    public function destroy($id)
    {
        $machine = $this->repository->find($id);
        if($machine->plcData()->exists()) {
            return back()->with('error', 'Không thể xóa máy đã có dữ liệu!');
        }

        $this->repository->delete($id);
        return redirect()->route('plc.machine.index')
            ->with('success', 'Xóa máy thành công!');
    }

    public function toggleStatus($id)
    {
        $this->repository->toggleStatus($id);
        return back()->with('success', 'Cập nhật trạng thái thành công!');
    }
}

================
File: app/Http/Controllers/Plc/MachineThresholdController.php
================
<?php
namespace App\Http\Controllers\Plc;

use App\Http\Controllers\Controller;
use App\Models\Machine;
use App\Models\MachineThreshold;
use App\Repositories\Plc\MachineThresholdRepository;
use Illuminate\Http\Request;

class MachineThresholdController extends Controller
{
    protected $repository;

    public function __construct(MachineThresholdRepository $repository)
    {
        $this->repository = $repository;
    }

    public function show($machine_id)
    {
        $machine = Machine::findOrFail($machine_id);
        $thresholds = $this->repository->getByMachine($machine_id);
        $availableColumns = MachineThreshold::getAvailablePlcDataColumns();

        return view('plc.machine_threshold.show', compact('machine', 'thresholds', 'availableColumns'));
    }

    public function create($machine_id)
    {
        $machine = Machine::findOrFail($machine_id);
        $availableColumns = MachineThreshold::getAvailablePlcDataColumns();

        return view('plc.machine_threshold.create', compact('machine', 'availableColumns'));
    }

    public function store(Request $request)
    {
        $data = $request->validate($this->repository->validateCreate());

        try {
            $this->repository->create($data);

            return redirect()
                ->route('plc.machine.thresholds.show', $request->machine_id)
                ->with('success', 'Thêm cảnh báo thành công');
        } catch (\Exception $e) {
            return back()
                ->withInput()
                ->with('error', 'Có lỗi xảy ra: ' . $e->getMessage());
        }
    }

    public function edit($id)
    {
        $threshold = MachineThreshold::findOrFail($id);
        $availableColumns = MachineThreshold::getAvailablePlcDataColumns();

        return view('plc.machine_threshold.edit', compact('threshold', 'availableColumns'));
    }

    public function update(Request $request, $id)
    {
        $data = $request->validate($this->repository->validateUpdate($id));
        $threshold = MachineThreshold::findOrFail($id);

        try {
            $this->repository->update($data, $id);

            return redirect()
                ->route('plc.machine.thresholds.show', $threshold->machine_id)
                ->with('success', 'Cập nhật cảnh báo thành công');
        } catch (\Exception $e) {
            return back()
                ->withInput()
                ->with('error', 'Có lỗi xảy ra: ' . $e->getMessage());
        }
    }

    public function destroy($id)
    {
        try {
            $threshold = MachineThreshold::findOrFail($id);
            $machine_id = $threshold->machine_id;
            $this->repository->delete($id);

            return redirect()
                ->route('plc.machine.thresholds.show', $machine_id)
                ->with('success', 'Xóa cảnh báo thành công');
        } catch (\Exception $e) {
            return back()->with('error', 'Có lỗi xảy ra: ' . $e->getMessage());
        }
    }

    public function toggleChart($id)
    {
        try {
            $threshold = $this->repository->find($id);
            $threshold->show_on_chart = !$threshold->show_on_chart;
            $threshold->save();

            return response()->json(['success' => true]);
        } catch (\Exception $e) {
            return response()->json(['success' => false, 'message' => $e->getMessage()], 500);
        }
    }

    public function toggleStatus($id)
    {
        try {
            $threshold = $this->repository->find($id);
            $threshold->status = !$threshold->status;
            $threshold->save();

            return response()->json(['success' => true]);
        } catch (\Exception $e) {
            return response()->json(['success' => false, 'message' => $e->getMessage()], 500);
        }
    }
}

================
File: app/Http/Controllers/Plc/PlcController.php
================
<?php

namespace App\Http\Controllers\Plc;

use Illuminate\Http\Request;
use App\Http\Controllers\Controller;

class PlcController extends Controller
{
    public function index()
    {
        return view('plc/index');
    }


}

================
File: app/Http/Controllers/Controller.php
================
<?php

namespace App\Http\Controllers;

use Illuminate\Foundation\Auth\Access\AuthorizesRequests;
use Illuminate\Foundation\Validation\ValidatesRequests;
use Illuminate\Routing\Controller as BaseController;
use App\Common\Traits\GetEnumDatas;
use App\Common\Traits\UploadFiles;
use App\Common\StringHelpers;

class Controller extends BaseController
{
    //use UploadImage, UploadImages;
    use AuthorizesRequests, ValidatesRequests;
}

================
File: app/Http/Middleware/Admin.php
================
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Support\Facades\Auth;
use App\User;
use Illuminate\Support\Facades\DB;

class Admin
{

    /**
     * Handle an incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return mixed
     */
    public function handle($request, Closure $next)
    {
        $current_route = $request->route()->getName();

        if (strpos($current_route, 'create') !== false) {
            $parent_route = str_replace('create', 'index', $current_route);
            $method = 'create';
        } elseif (strpos($current_route, 'edit') !== false) {
            $parent_route = str_replace('edit', 'index', $current_route);
            $method = 'edit';
        }
        elseif (strpos($current_route, 'index') !== false) {
            $parent_route = str_replace('index', 'create', $current_route);
            //dd($parent_route);
            if(\Route::has($parent_route))
            {
                $method = 'create';
            }
            else{
                $method = 'index';
            }
        }
        else {
            $parent_route = null;
            $method = 'index';
        }


        if (!is_null(Auth::user())) {
            if (Auth::user()->is_root == false && $current_route != 'recruitment.index' && $current_route != 'recruitment.403') {
                $permissions = DB::table('role')->whereIn('id', explode(',', Auth::user()->role_id))->get()->pluck('permissons');
                if ($permissions) {
                    foreach ($permissions as $permission) {
                        if (strpos($permission, $current_route) === false) {
                            //return view('recruitment.abort.403');
                            abort(403, 'Bạn không có quyền truy cập chức năng này');
                        }
                    }
                } else {
                    //return view('recruitment.abort.403');
                    abort(403, 'Bạn không có quyền truy cập chức năng này');
                }
            }
            if ($parent_route == null) {
                $parent_route = $current_route;
            }

            // dd($method);
            \View::share(['current_route' => $current_route, 'parent_route' => $parent_route, 'method' => $method]);
            return $next($request);

        } else {
            return redirect()->route('auth.login');
        }
    }

}

================
File: app/Http/Middleware/Authenticate.php
================
<?php

namespace App\Http\Middleware;

use Illuminate\Auth\Middleware\Authenticate as Middleware;
use Illuminate\Http\Request;

class Authenticate extends Middleware
{
    /**
     * Get the path the user should be redirected to when they are not authenticated.
     */
    protected function redirectTo(Request $request): ?string
    {
        return $request->expectsJson() ? null : route('login');
    }
}

================
File: app/Http/Middleware/CkfinderAuthentication.php
================
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class ckFinderAuthentication
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        // if (Auth::check()) {
        //     config(['ckfinder.authentication' => function() use ($request) {
        //         return true;
        //     }] );
        // } else {
        //     config(['ckfinder.authentication' => function() use ($request) {
        //         return false;
        //     }] );
        // }

        config(['ckfinder.authentication' => function() use ($request) {
                    return true;
                }] );

        return $next($request);
    }
}

================
File: app/Http/Middleware/EncryptCookies.php
================
<?php

namespace App\Http\Middleware;

use Illuminate\Cookie\Middleware\EncryptCookies as Middleware;

class EncryptCookies extends Middleware
{
    /**
     * The names of the cookies that should not be encrypted.
     *
     * @var array<int, string>
     */
    protected $except = [
        'ckCsrfToken',
        //
    ];
}

================
File: app/Http/Middleware/Personnel.php
================
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Support\Facades\Auth;
use App\User;
use Illuminate\Support\Facades\DB;

class Personnel
{

    /**
     * Handle an incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return mixed
     */
    public function handle($request, Closure $next)
    {

        $current_route = $request->route()->getName();

        if (strpos($current_route, 'create') !== false) {
            $parent_route = str_replace('create', 'index', $current_route);
            $method = 'create';
        } elseif (strpos($current_route, 'edit') !== false) {
            $parent_route = str_replace('edit', 'index', $current_route);
            $method = 'edit';
        }
        elseif (strpos($current_route, 'index') !== false) {
            $parent_route = str_replace('index', 'create', $current_route);
            //dd($parent_route);
            if(\Route::has($parent_route))
            {
                $method = 'create';
            }
            else{
                $method = 'index';
            }
        }
        else {
            $parent_route = null;
            $method = 'index';
        }

        if (!is_null(Auth::user())) {
            // if (Auth::user()->is_root == false && $current_route != 'recruitment.index' && $current_route != 'recruitment.403') {
            //     $permissions = DB::table('role')->whereIn('id', explode(',', Auth::user()->role_id))->get()->pluck('permissons');
            //     if ($permissions) {
            //         foreach ($permissions as $permission) {
            //             if (strpos($permission, $current_route) === false) {
            //                 //return view('recruitment.abort.403');
            //                 abort(403, 'Bạn không có quyền truy cập chức năng này');
            //             }
            //         }
            //     } else {
            //         //return view('recruitment.abort.403');
            //         abort(403, 'Bạn không có quyền truy cập chức năng này');
            //     }
            // }
            if ($parent_route == null) {
                $parent_route = $current_route;
            }

            // dd($method);
            \View::share(['current_route' => $current_route, 'parent_route' => $parent_route, 'method' => $method]);
            return $next($request);

        } else {
            return redirect()->route('auth.login');
        }
    }

}

================
File: app/Http/Middleware/PreventRequestsDuringMaintenance.php
================
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance as Middleware;

class PreventRequestsDuringMaintenance extends Middleware
{
    /**
     * The URIs that should be reachable while maintenance mode is enabled.
     *
     * @var array<int, string>
     */
    protected $except = [
        //
    ];
}

================
File: app/Http/Middleware/RedirectIfAuthenticated.php
================
<?php

namespace App\Http\Middleware;

use App\Providers\RouteServiceProvider;
use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Symfony\Component\HttpFoundation\Response;

class RedirectIfAuthenticated
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next, string ...$guards): Response
    {
        $guards = empty($guards) ? [null] : $guards;

        foreach ($guards as $guard) {
            if (Auth::guard($guard)->check()) {
                return redirect(RouteServiceProvider::HOME);
            }
        }

        return $next($request);
    }
}

================
File: app/Http/Middleware/TrimStrings.php
================
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\TrimStrings as Middleware;

class TrimStrings extends Middleware
{
    /**
     * The names of the attributes that should not be trimmed.
     *
     * @var array<int, string>
     */
    protected $except = [
        'current_password',
        'password',
        'password_confirmation',
    ];
}

================
File: app/Http/Middleware/TrustHosts.php
================
<?php

namespace App\Http\Middleware;

use Illuminate\Http\Middleware\TrustHosts as Middleware;

class TrustHosts extends Middleware
{
    /**
     * Get the host patterns that should be trusted.
     *
     * @return array<int, string|null>
     */
    public function hosts(): array
    {
        return [
            $this->allSubdomainsOfApplicationUrl(),
        ];
    }
}

================
File: app/Http/Middleware/TrustProxies.php
================
<?php

namespace App\Http\Middleware;

use Illuminate\Http\Middleware\TrustProxies as Middleware;
use Illuminate\Http\Request;

class TrustProxies extends Middleware
{
    /**
     * The trusted proxies for this application.
     *
     * @var array<int, string>|string|null
     */
    protected $proxies;

    /**
     * The headers that should be used to detect proxies.
     *
     * @var int
     */
    protected $headers =
        Request::HEADER_X_FORWARDED_FOR |
        Request::HEADER_X_FORWARDED_HOST |
        Request::HEADER_X_FORWARDED_PORT |
        Request::HEADER_X_FORWARDED_PROTO |
        Request::HEADER_X_FORWARDED_AWS_ELB;
}

================
File: app/Http/Middleware/UnisharpAuthentication.php
================
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class UnisharpAuthentication
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        // if (Auth::check()) {
        //     config(['ckfinder.authentication' => function() use ($request) {
        //         return true;
        //     }] );
        // } else {
        //     config(['ckfinder.authentication' => function() use ($request) {
        //         return false;
        //     }] );
        // }

        config(['ckfinder.authentication' => function() use ($request) {
            return true;
        }] );

        return $next($request);
    }
}

================
File: app/Http/Middleware/ValidateSignature.php
================
<?php

namespace App\Http\Middleware;

use Illuminate\Routing\Middleware\ValidateSignature as Middleware;

class ValidateSignature extends Middleware
{
    /**
     * The names of the query string parameters that should be ignored.
     *
     * @var array<int, string>
     */
    protected $except = [
        // 'fbclid',
        // 'utm_campaign',
        // 'utm_content',
        // 'utm_medium',
        // 'utm_source',
        // 'utm_term',
    ];
}

================
File: app/Http/Middleware/VerifyCsrfToken.php
================
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as Middleware;

class VerifyCsrfToken extends Middleware
{
    /**
     * The URIs that should be excluded from CSRF verification.
     *
     * @var array<int, string>
     */
    protected $except = [
        'ckfinder/*',
        //
    ];
}

================
File: app/Http/Kernel.php
================
<?php

namespace App\Http;

use Illuminate\Foundation\Http\Kernel as HttpKernel;

class Kernel extends HttpKernel
{
    /**
     * The application's global HTTP middleware stack.
     *
     * These middleware are run during every request to your application.
     *
     * @var array<int, class-string|string>
     */
    protected $middleware = [
        // \App\Http\Middleware\TrustHosts::class,
        \App\Http\Middleware\TrustProxies::class,
        \Illuminate\Http\Middleware\HandleCors::class,
        \App\Http\Middleware\PreventRequestsDuringMaintenance::class,
        \Illuminate\Foundation\Http\Middleware\ValidatePostSize::class,
        \App\Http\Middleware\TrimStrings::class,
        \Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull::class,
        \Illuminate\Session\Middleware\StartSession::class,
        \Illuminate\View\Middleware\ShareErrorsFromSession::class,
    ];

    /**
     * The application's route middleware groups.
     *
     * @var array<string, array<int, class-string|string>>
     */
    protected $middlewareGroups = [
        'web' => [
            \App\Http\Middleware\EncryptCookies::class,
            \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
            \Illuminate\Session\Middleware\StartSession::class,
            \App\Http\Middleware\VerifyCsrfToken::class,
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],

        'api' => [
            \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class,
            \Illuminate\Routing\Middleware\ThrottleRequests::class.':api',
            \Illuminate\View\Middleware\ShareErrorsFromSession::class,
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],

    ];

    /**
     * The application's middleware aliases.
     *
     * Aliases may be used instead of class names to conveniently assign middleware to routes and groups.
     *
     * @var array<string, class-string|string>
     */
    protected $middlewareAliases = [
        'auth' => \App\Http\Middleware\Authenticate::class,
        'auth.basic' => \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
        'auth.session' => \Illuminate\Session\Middleware\AuthenticateSession::class,
        'cache.headers' => \Illuminate\Http\Middleware\SetCacheHeaders::class,
        'can' => \Illuminate\Auth\Middleware\Authorize::class,
        'guest' => \App\Http\Middleware\RedirectIfAuthenticated::class,
        'password.confirm' => \Illuminate\Auth\Middleware\RequirePassword::class,
        'precognitive' => \Illuminate\Foundation\Http\Middleware\HandlePrecognitiveRequests::class,
        'signed' => \App\Http\Middleware\ValidateSignature::class,
        'throttle' => \Illuminate\Routing\Middleware\ThrottleRequests::class,
        'verified' => \Illuminate\Auth\Middleware\EnsureEmailIsVerified::class,
        'admin' => \App\Http\Middleware\Admin::class,
        'personnel' => \App\Http\Middleware\Personnel::class,
        'unisharp' => \App\Http\Middleware\UnisharpAuthentication::class,
    ];
}

================
File: app/Jobs/SendHtmlEmailJob.php
================
<?php

namespace App\Jobs;

use App\Mail\HtmlEmailMailable;
use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Foundation\Bus\Dispatchable;
use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Queue\SerializesModels;
use Illuminate\Support\Facades\Mail;

class SendHtmlEmailJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    protected $to;
    protected $htmlContent;

    public function __construct($to, $htmlContent)
    {
        $this->to = $to;
        $this->htmlContent = $htmlContent;
    }

    public function handle()
    {
        Mail::to($this->to)->send(new HtmlEmailMailable($this->htmlContent));
    }
}

================
File: app/Jobs/SyncDepartmentToOtherDb.php
================
<?php

namespace App\Jobs;

use App\Models\Department;
use Illuminate\Bus\Queueable;
use Illuminate\Support\Carbon;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;
use Illuminate\Queue\SerializesModels;
use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Foundation\Bus\Dispatchable;
use Illuminate\Contracts\Queue\ShouldBeUnique;

class SyncDepartmentToOtherDb implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    protected $department;
    protected $database;
    protected $action;

    /**
     * Create a new job instance.
     */
    public function __construct(Department $department, $database, $action)
    {
        $this->department = $department;
        $this->database = $database;
        $this->action = $action;
    }

    /**
     * Execute the job.
     */
    public function handle(): void
    {
        try {
            DB::connection($this->database)->beginTransaction();

            // Logic đồng bộ dữ liệu cho cơ sở dữ liệu hiện tại
            $this->syncToDatabase();

            DB::connection($this->database)->commit();
            Log::info("Đồng bộ user thành công cho DB {$this->database}");
        } catch (\Exception $e) {
            DB::connection($this->database)->rollBack();
            Log::error("Lỗi đồng bộ user cho DB {$this->database}", ['error' => $e->getMessage()]);
            // Xử lý thêm nếu cần
        }
    }

    /**
     * Đồng bộ dữ liệu người dùng với cơ sở dữ liệu.
     *
     * @return void
     */
    private function syncToDatabase()
    {
        try {
                $data['display_name'] = $this->department->name;
                $data['name'] = $this->department->code;
                $data['block'] = optional($this->department->parent)->code;
                $data['update_at'] = Carbon::now();

            if ($this->action == 'create') {
                $data['create_at'] = Carbon::now();
                DB::connection($this->database)->table('department')->insert($data);
            }
            if ($this->action == 'update') {
                $query = DB::connection($this->database)->table('department')
                    ->where('name', $this->department->code)->update($data);
            }

        } catch (\Exception $e) {
            // Xử lý lỗi nếu cần
            throw $e; // Ném lại ngoại lệ để xử lý lỗi ở nơi gọi
        }
    }
}

================
File: app/Jobs/SyncPositionToOtherDb.php
================
<?php

namespace App\Jobs;

use App\Models\Position;
use Illuminate\Bus\Queueable;
use Illuminate\Support\Carbon;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;
use Illuminate\Queue\SerializesModels;
use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Foundation\Bus\Dispatchable;
use Illuminate\Contracts\Queue\ShouldBeUnique;

class SyncPositionToOtherDb implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    protected $position;
    protected $database;
    protected $action;
    /**
     * Create a new job instance.
     */
    public function __construct(Position $position, $database, $action)
    {
        $this->position = $position;
        $this->database = $database;
        $this->action = $action;
    }

    /**
     * Execute the job.
     */
    public function handle(): void
    {
        try {
            DB::connection($this->database)->beginTransaction();

            // Logic đồng bộ dữ liệu cho cơ sở dữ liệu hiện tại
            $this->syncToDatabase();

            DB::connection($this->database)->commit();
            Log::info("Đồng bộ user thành công cho DB {$this->database}");
        } catch (\Exception $e) {
            DB::connection($this->database)->rollBack();
            Log::error("Lỗi đồng bộ user cho DB {$this->database}", ['error' => $e->getMessage()]);
            // Xử lý thêm nếu cần
        }
    }

    /**
     * Đồng bộ dữ liệu người dùng với cơ sở dữ liệu.
     *
     * @return void
     */
    private function syncToDatabase()
    {
        try {
            $data = [
                'display_name' => $this->position->name,
                'update_at' => Carbon::now(),
                'name' => $this->position->code,
            ];

            if ($this->action == 'create') {
                $data['create_at'] = Carbon::now();
                DB::connection($this->database)->table('position')->insert($data);
            } else if ($this->action == 'update') {
                DB::connection($this->database)->table('position')
                    ->where('name', $this->position->code)
                    ->update($data);
            }
        } catch (\Exception $e) {
            // Xử lý lỗi nếu cần
            throw $e; // Ném lại ngoại lệ để xử lý lỗi ở nơi gọi
        }
    }
}

================
File: app/Jobs/SyncUserToOtherDb.php
================
<?php

namespace App\Jobs;

use App\Models\User;
use Illuminate\Bus\Queueable;
use Illuminate\Support\Carbon;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;
use Illuminate\Queue\SerializesModels;
use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Foundation\Bus\Dispatchable;

class SyncUserToOtherDb implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    protected $user;
    protected $database;
    protected $action;

    /**
     * Tạo một instance mới của job.
     *
     * @param  \App\Models\User  $user
     * @param  string  $database
     * @return void
     */
    public function __construct(User $user, $database, $action)
    {
        $this->user = $user;
        $this->database = $database;
        $this->action = $action;
    }

    /**
     * Thực hiện job.
     *
     * @return void
     */
    public function handle()
    {
        try {
            DB::connection($this->database)->beginTransaction();

            // Logic đồng bộ dữ liệu cho cơ sở dữ liệu hiện tại
            $this->syncToDatabase();

            DB::connection($this->database)->commit();
            Log::info("Đồng bộ user thành công cho DB {$this->database}", ['user_id' => $this->user->id]);
        } catch (\Exception $e) {
            // Nếu có lỗi trong quá trình xử lý thì rollback lại các thay đổi
            DB::connection($this->database)->rollBack();
            Log::error("Lỗi đồng bộ user cho DB {$this->database}", ['user_id' => $this->user->id, 'error' => $e->getMessage()]);
        }
    }

    /**
     * Đồng bộ dữ liệu người dùng với cơ sở dữ liệu.
     *
     * @return void
     */

    private function syncToDatabase()
    {
        try {

           $data =
                [
                    'display_name' => $this->user->name,
                    'employeeNumber'=> $this->user->code,
                    'email' => $this->user->email,
                    'taxCode' => $this->user->tax_code,
                    'sex' => $this->user->gender === 'male' ? 'Nam' : 'Nữ',
                    'date_of_birth' => $this->user->birthday,
                    'type_of_contract' => $this->user->contract_type,
                    'termination_retirement' => $this->user->end_job,
                    'phone_Number' => $this->user->phone_number,
                    'cccd' => $this->user->cccd,
                    'jobTitle' => optional($this->user->position)->name,
                    'cccd_issuer' => $this->user->cccd_issuer,
                    'cccd_date' => $this->user->cccd_date,
                    'contract_start' => $this->user->contract_start,
                    'contract_end' => $this->user->contract_end,
                    'department' => optional($this->user->department)->code,
                    'username' => $this->user->code,
                    'password_hash' => $this->user->password,
                    'block' => optional(optional($this->user->department)->parent)->code,
                    'status' => 'NTP',
                    'update_at' => Carbon::now(),
                ];
                //dd($data);

            if ($this->action == 'create') {
                $data['create_at'] = Carbon::now();
                DB::connection($this->database)->table('users')->insert($data);
            } else if ($this->action == 'update') {
                DB::connection($this->database)->table('users')
                    ->where('employeeNumber', $this->user->code)
                    ->update($data);
            }

        } catch (\Exception $e) {
            // Xử lý lỗi nếu cần
            throw $e; // Ném lại ngoại lệ để xử lý lỗi ở nơi gọi
        }
    }
}

================
File: app/Models/Machine.php
================
<?php

namespace App\Models;

use App\Models\PlcData;
use Illuminate\Database\Eloquent\Model;

class Machine extends Model
{
    protected $table='machine';

    protected $fillable = [
        'name',
        'code',
        'ip_address',
        'status',
        'description'
    ];

    // Relationship với PlcData
    public function plcData()
    {
        return $this->hasMany(PlcData::class);
    }

    // Scope để lấy máy đang hoạt động
    public function scopeActive($query)
    {
        return $query->where('status', 1);
    }
}

================
File: app/Models/MachineThreshold.php
================
<?php

namespace App\Models;

use App\Models\Machine;
use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Eloquent\Model;

class MachineThreshold extends Model
{
    protected $table = 'machine_threshold';
    protected $fillable = [
       'machine_id',
       'name',
       'plc_data_key',
       'type', // boolean/parameter
       'value', // for boolean
       'warning_message',
       'min_value',
       'max_value',
       'warning_min_value',  // Text cảnh báo khi < min
       'warning_max_value', // Text cảnh báo khi > max
       'show_on_chart',
       'status',
   ];

   public static function getAvailablePlcDataColumns()
   {
       $excludedColumns = ['id', 'machine_id', 'created_at', 'updated_at'];
       return array_diff(Schema::getColumnListing('plc_data'), $excludedColumns);
   }

    protected $casts = [
        'status' => 'boolean'
    ];

    public function machine()
    {
        return $this->belongsTo(Machine::class);
    }

    public static function getDefaultParameters()
    {
        return [
            [
                'name' => 'Báo lỗi hiện tần động cơ vít xoắn',
                'plc_data_key' => '%40.1',
                'data_type' => 'bool',
                'alert_type' => 'boolean',
                'description' => 'Lỗi = 1'
            ],
            [
                'name' => 'Báo lỗi hiện tần động cơ máy chỉ',
                'plc_data_key' => '%40.2',
                'data_type' => 'bool',
                'alert_type' => 'boolean',
                'description' => 'Lỗi = 1'
            ],
            [
                'name' => 'Báo lỗi hiện tần động cơ dàn kéo',
                'plc_data_key' => '%40.3',
                'data_type' => 'bool',
                'alert_type' => 'boolean',
                'description' => 'Lỗi = 1'
            ],
            [
                'name' => 'Động khởi chạy',
                'plc_data_key' => '%Q0.2',
                'data_type' => 'bool',
                'alert_type' => 'boolean',
                'description' => 'on = 1'
            ],
            [
                'name' => 'Điều khiển động cơ chính',
                'plc_data_key' => '%Q0.2',
                'data_type' => 'bool',
                'alert_type' => 'boolean',
                'description' => 'on = 1'
            ],
            [
                'name' => 'Tốc độ thực tế VX',
                'plc_data_key' => '%MD108',
                'data_type' => 'real',
                'alert_type' => 'parameter',
                'description' => 'Vẽ biểu đồ thời gian trình mẫu'
            ],
            [
                'name' => 'Tốc độ thực tế máy chỉ',
                'plc_data_key' => '%MD112',
                'data_type' => 'real',
                'alert_type' => 'parameter',
                'description' => 'Vẽ biểu đồ thời gian trình mẫu'
            ],
            [
                'name' => 'Nhiệt độ nhựa',
                'plc_data_key' => '%MD176',
                'data_type' => 'real',
                'alert_type' => 'parameter',
                'description' => 'Vẽ biểu đồ thời gian trình mẫu'
            ],
            [
                'name' => 'Áp lực nhựa',
                'plc_data_key' => '%MD180',
                'data_type' => 'real',
                'alert_type' => 'parameter',
                'description' => 'Vẽ biểu đồ thời gian trình mẫu'
            ],
            [
                'name' => 'Tốc độ đặt VX',
                'plc_data_key' => '%MD120',
                'data_type' => 'real',
                'alert_type' => 'parameter',
                'description' => 'Vẽ biểu đồ thời gian trình mẫu'
            ]
        ];
    }

    // Lấy danh sách các cột có thể sử dụng từ bảng plc_data
    // public static function getAvailablePlcDataColumns()
    // {
    //     $excludedColumns = ['id', 'machine_id', 'created_at', 'updated_at'];
    //     return array_diff(
    //         \Schema::getColumnListing('plc_data'),
    //         $excludedColumns
    //     );
    // }

    // Kiểm tra giá trị có vượt ngưỡng không
    public function checkThreshold($value)
    {
        if (!$this->is_active || is_null($value)) return null;

        if ($this->min_value !== null && $value < $this->min_value) {
            return ['type' => 'danger', 'message' => 'Dưới ngưỡng cho phép'];
        }
        if ($this->warning_min_value !== null && $value < $this->warning_min_value) {
            return ['type' => 'warning', 'message' => 'Gần ngưỡng dưới'];
        }
        if ($this->max_value !== null && $value > $this->max_value) {
            return ['type' => 'danger', 'message' => 'Trên ngưỡng cho phép'];
        }
        if ($this->warning_max_value !== null && $value > $this->warning_max_value) {
            return ['type' => 'warning', 'message' => 'Gần ngưỡng trên'];
        }

        return null;
    }
}

================
File: app/Models/PlcData.php
================
<?php
namespace App\Models;

use App\Models\Machine;
use Illuminate\Database\Eloquent\Model;

class PlcData extends Model
{
    protected $table = "plc_data";

    protected $fillable = [
        'machine_id',
        'date',
        'ca',
        // Thông tin công nhân và sản phẩm
        'cn1',           // Công nhân 1
        'cn2',           // Công nhân 2
        'to',            // Tổ sản xuất
        'ma_sp',         // Mã sản phẩm
        'nl1',           // Nguyên liệu 1
        'nl2',           // Nguyên liệu 2
        'nl_chi',        // Nguyên liệu chỉ
        'mau_chi',       // Màu chỉ
        'ma_dh',         // Mã đơn hàng
        'thn',           // THN
        'tht',           // THT
        'chuot',         // CHUOT

        // Thông số vận hành
        'toc_do_vx',
        'toc_do_may_chi',
        'toc_do_dan_keo',
        'toc_do_dat_vx',         // Tốc độ đặt VX
        'toc_do_dat_may_chi',    // Tốc độ đặt máy chỉ
        'toc_do_dat_dan_keo',    // Tốc độ đặt dàn kéo
        'ap_luc_nhua',
        'nhiet_do_nhua',
        'tai_thuc_te_dc_chinh',  // Tải thực tế DC chính
        'tai_thuc_te_may_chi',
        'can_thuc_te',           // Cân thực tế
        'nang_suat',             // Năng suất(kg/h)
        'dinh_luong_gm',         // Định lượng g/m
        'dinh_luong_dat_gm',     // Định lượng đặt g/m
        'toc_do_dat_bom_ck',     // HMI tốc độ đặt bơm CK

        // Nhiệt độ các vùng
        'nhiet_do_co_cl',        // Nhiệt độ thực tế cổ CL
        'nhiet_do_xl_1',         // Nhiệt độ thực tế XL 1
        'nhiet_do_xl_2',
        'nhiet_do_xl_3',
        'nhiet_do_xl_4',
        'nhiet_do_xl_5',
        'nhiet_do_cn',           // Nhiệt độ thực tế CN
        'nhiet_do_dh_1',
        'nhiet_do_dh_2',
        'nhiet_do_dh_3',
        'nhiet_do_dh_4',
        'nhiet_do_dh_5',
        'nhiet_do_dh_6',
        'nhiet_do_dh_7',         // Nhiệt độ thực tế ĐH 7
        'nhiet_do_dh_8',         // Nhiệt độ thực tế ĐH 8
        'nhiet_do_dh_9',         // Nhiệt độ thực tế ĐH 9
        'nhiet_do_dh_10',        // Nhiệt độ thực tế ĐH 10
        'nhiet_do_dh_11',        // Nhiệt độ thực tế ĐH 11
        'nhiet_do_dh_12',        // Nhiệt độ thực tế ĐH 12

        // Nhiệt độ máy chỉ
        'nhiet_do_may_chi_xl_1',
        'nhiet_do_may_chi_xl_2',
        'nhiet_do_may_chi_xl_3',
        'nhiet_do_may_chi_xl_4',

        // Thông số vacuum và CK
        'nhiet_do_nuoc_vacuum_1',
        'nhiet_do_nuoc_vacuum_2',
        'ap_suat_be_ck1',

        // Thời gian
        'gio_dung',          // Giờ dừng
        'gio_gia_nhiet',     // Giờ gia nhiệt
        'gio_chay_1',        // Giờ chạy 1
        'gio_chay_2',        // Giờ chạy 2

        // Trạng thái
        'trang_thai',        // Trạng thái hoạt động
    ];

    public function machine()
    {
        return $this->belongsTo(Machine::class);
    }
}

================
File: app/Models/User.php
================
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;
use Illuminate\Database\Eloquent\Concerns\HasUuids;
use Spatie\Activitylog\LogOptions;
use Spatie\Activitylog\Traits\LogsActivity;
use Illuminate\Support\Str;

class User extends Authenticatable
{
    use HasApiTokens, HasFactory, Notifiable, HasUuids;
    use LogsActivity;

    public function getActivitylogOptions(): LogOptions
    {
        return LogOptions::defaults()
            // Chain fluent methods to set configuration options
            ->logOnly(['*'])
            ->useLogName('Người dùng')
            ->setDescriptionForEvent(function (string $eventName) {
                return "Bảng này đã được {$eventName}";
            });
    }

    protected $table = "user";
    protected $fillable = [
        'name',
        'user_uid',
        'username',
        'refresh_token',
        'password',
        'password_hash',
        'email',
        'gender',
        'birthday',
        'address',
        'phone_number',
        'email_send',
        'email_reply',
        'email_footer',
        'cccd',
        'avatar',
        'created_by',
        'active',
        'is_root',
        'role_id',
        'department_id',
        'position_id',
        'mail_footer',

        'code',
        'uuid',
        'tax_code',
        'status',
        'contract_signing_date',
        'contract_type',
        'contract_status',
        'contract_start',
        'end_job_date',
        'cccd_issuer',
        'cccd_date',
        'note',
        'contact',
        'remember_token',
        'level',
    ];

    protected $fieldMetadata = [
        [
            'field' => 'name',          //Tên cột
            'show' => true,             //Show trong index
            // 'type' => 'text',        //Loại dữ liệu, nếu không khai báo sẽ tự động lấy type
            'label' => 'Họ và tên',     //Nhãn
            'isCreate' => true,         //Hiển thị khi tạo mới
            'isEdit' => true,           //Hiển thị khi xem chi tiết
            'search' => true,         //Là trường search trong danh sách dữ liệu
            'required' => true,
        ],
        [
            'field' => 'code',
            'show' => true,
            'label' => 'Mã nhân sự',
            'isCreate' => true,
            'isEdit' => true,
            'search' => true,
            'required' => true,
        ],
        [
            'field' => 'password',
            'show' => false,
            'type' => 'password',
            'label' => 'Mật khẩu',
            'create' => true,
            'update' => false,
            'search' => false,
        ],
        [
            'field' => 'tax_code',
            'show' => true,
            'label' => 'Mã số thuế',
            'isCreate' => true,
            'isEdit' => true,
            'search' => false,
            'required' => true,
        ],
        [
            'field' => 'email',
            'show' => true,
            'type' => 'email',
            'label' => 'Email',
            'required' => true,
        ],
        [
            'field' => 'birthday',
            'show' => true,
            'label' => 'Ngày sinh',
            'isCreate' => true,
            'isEdit' => true,
            'search' => true,
            'required' => true,
        ],
        [
            'field' => 'gender',
            'show' => false,
            'label' => 'Giới tính',
            'isCreate' => true,
            'isEdit' => true,
            'search' => true,
            'required' => true,
        ],
        [
            'field' => 'address',
            'show' => false,
            'type' => 'text',
            'label' => 'Địa chỉ',
            'isCreate' => true,
            'isEdit' => true,
            'search' => false,
        ],
        [
            'field' => 'phone_number',
            'show' => true,
            'label' => 'Số điện thoại',
            'isCreate' => true,
            'isEdit' => true,
            'search' => false,
            'required' => true,
        ],
        [
            'field' => 'cccd',
            'show' => false,
            'label' => 'Căn cước công dân',
            'isCreate' => true,
            'isEdit' => true,
            'search' => false,
            'required' => true,
        ],
        [
            'field' => 'cccd_date',
            'show' => false,
            'label' => 'Ngày cấp căn cước',
            'isCreate' => true,
            'isEdit' => true,
            'search' => false,
        ],
        [
            'field' => 'cccd_issuer',
            'show' => false,
            'label' => 'Nơi cấp căn cước',
            'isCreate' => true,
            'isEdit' => true,
            'search' => false,
        ],
        [
            'field' => 'department_id',
            'show' => false,
            'label' => 'Phòng ban',
            'isCreate' => true,
            'isEdit' => true,
            'search' => true,
            'relation' => 'department',
            'relationField' => 'name',
            'required' => true,
        ],
        [
            'field' => 'position_id',
            'show' => false,
            'label' => 'Vị trí',
            'isCreate' => true,
            'isEdit' => true,
            'search' => true,
            'relation' => 'position',
            'relationField' => 'name',
            'required' => true,
        ],
        [
            'field' => 'role_id',
            'show' => true,
            'label' => 'Vai trò',
            'isCreate' => true,
            'isEdit' => true,
            'search' => false,
            'required' => true,
            'multiple' => true,
            'relation' => 'role',
            'relationField' => 'name',
        ],
        [
            'field' => 'note',
            'show' => false,
            'label' => 'Ghi chú',
            'canCreate' => true,
            'canEdit' => true,
            'search' => false,
        ],
        [
            'field' => 'active',
            'show' => true,
            'label' => 'Hoạt động',
            'isCreate' => true,
            'isEdit' => true,
            'search' => false,
        ],
        // [
        //     'field' => 'created_at', //Trường hợp lọc trong khoảng thời gian
        //     'label' => 'Ngày tạo',
        //     'type' => 'date-range',
        //     'search' => true,
        //     'start_field' => [
        //         'name' => 'start_date', // Tên trường ngày bắt đầu trong request
        //         'label' => 'Ngày Bắt Đầu', // Label cho ngày bắt đầu
        //     ],
        //     'end_field' => [
        //         'name' => 'end_date', // Tên trường ngày kết thúc trong request
        //         'label' => 'Ngày Kết Thúc', // Label cho ngày kết thúc
        //     ],
        // ],
    ];

    public function getFieldMetadata()
    {
        foreach ($this->fieldMetadata as $key => &$value) {
            // Đảm bảo rằng 'type' luôn được thiết lập tránh lỗi khi quên isset value
            if (!isset($value['type'])) {
                $value['type'] = $this->getFieldType($value['field']);
            }

            $value['show'] = $value['show'] ?? false;
            $value['isCreate'] = $value['isCreate'] ?? false;
            $value['isEdit'] = $value['isEdit'] ?? false;
            $value['search'] = $value['search'] ?? false;
            $value['required'] = $value['required'] ?? false;

            // Xử lý cho 'date-range'
            if ($value['type'] == 'date-range') {
                $value['start_field']['name'] = $value['start_field']['name'] ?? '';
                $value['start_field']['label'] = $value['start_field']['label'] ?? '';
                $value['end_field']['name'] = $value['end_field']['name'] ?? '';
                $value['end_field']['label'] = $value['end_field']['label'] ?? '';
            }
        }
        return $this->fieldMetadata;
    }
    public function getFieldType($fieldName)
    {
        // Sử dụng $this để thực hiện truy vấn trên bảng của User model
        $columnType = \Schema::getColumnType($this->getTable(), $fieldName);

        switch ($columnType) {
            case 'varchar':
            case 'nvarchar':
            case 'char':
                return 'string';
            case 'text':
                // Kiểm tra xem có phải là email hay không
                if (Str::endsWith($fieldName, 'email')) {
                    return 'email';
                }
                // Kiểm tra xem có phải là URL hay không
                if (Str::endsWith($fieldName, 'url')) {
                    return 'url';
                }
                // Kiểm tra xem có phải là hình ảnh hay không
                if (Str::endsWith($fieldName, 'image')) {
                    return 'image';
                }
                return 'text';

            case 'int':
            case 'bigint':
            case 'smallint':
            case 'mediumint':
            case 'tinyint':
                return 'number';

            case 'date':
                return 'date';

            case 'datetime':
            case 'timestamp':
                return 'datetime-local';

            case 'time':
                return 'time';

            case 'boolean':
                return 'checkbox';

            case 'decimal':
            case 'float':
            case 'double':
                return 'number';
            default:
                return 'text';
        }
    }


    protected $hidden = [
        'password',
        'refresh_token',
        'remember_token',
    ];

    protected $casts = [
        'email_verified_at' => 'datetime',
        'password' => 'hashed',
    ];

    public function getImage()
    {
        $image_arr = explode(',', $this->images);
        return $image_arr[0];
    }

    public function createdAt()
    {
        return date('d/m/Y', strtotime($this->created_at));
    }

    public function updatedAt()
    {
        return date('d/m/Y', strtotime($this->updated_at));
    }

    public function createdBy()
    {
        return $this->belongsTo('App\Models\User', 'created_by');
    }
    public function role()
    {
        return $this->belongsTo('App\Models\Role', 'role_id');
    }
    public function department()
    {
        return $this->belongsTo('App\Models\Department', 'department_id');
    }

    public function position()
    {
        return $this->belongsTo('App\Models\Position', 'position_id');
    }


}

================
File: app/Providers/AppServiceProvider.php
================
<?php

namespace App\Providers;

use App\Models\User;
use App\Models\Position;
use App\Models\Department;
use App\Observers\UserObserver;
use App\Observers\PositionObserver;
use App\Observers\DepartmentObserver;
use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    /**
     * Register any application services.
     */
    public function register(): void
    {
        //
    }

    /**
     * Bootstrap any application services.
     */
    public function boot(): void
    {
        User::observe(UserObserver::class);
        Position::observe(PositionObserver::class);
        Department::observe(DepartmentObserver::class);
    }
}

================
File: app/Providers/AuthServiceProvider.php
================
<?php

namespace App\Providers;

// use Illuminate\Support\Facades\Gate;
use Illuminate\Foundation\Support\Providers\AuthServiceProvider as ServiceProvider;

class AuthServiceProvider extends ServiceProvider
{
    /**
     * The model to policy mappings for the application.
     *
     * @var array<class-string, class-string>
     */
    protected $policies = [
        //
    ];

    /**
     * Register any authentication / authorization services.
     */
    public function boot(): void
    {
        //
    }
}

================
File: app/Providers/BroadcastServiceProvider.php
================
<?php

namespace App\Providers;

use Illuminate\Support\Facades\Broadcast;
use Illuminate\Support\ServiceProvider;

class BroadcastServiceProvider extends ServiceProvider
{
    /**
     * Bootstrap any application services.
     */
    public function boot(): void
    {
        Broadcast::routes();

        require base_path('routes/channels.php');
    }
}

================
File: app/Providers/EventServiceProvider.php
================
<?php

namespace App\Providers;

use Illuminate\Auth\Events\Registered;
use Illuminate\Auth\Listeners\SendEmailVerificationNotification;
use Illuminate\Foundation\Support\Providers\EventServiceProvider as ServiceProvider;
use Illuminate\Support\Facades\Event;

class EventServiceProvider extends ServiceProvider
{
    /**
     * The event to listener mappings for the application.
     *
     * @var array<class-string, array<int, class-string>>
     */
    protected $listen = [
        Registered::class => [
            SendEmailVerificationNotification::class,
            CandidateStatusChanged::class,

        ],
    ];

    /**
     * Register any events for your application.
     */
    public function boot(): void
    {
        //
    }

    /**
     * Determine if events and listeners should be automatically discovered.
     */
    public function shouldDiscoverEvents(): bool
    {
        return false;
    }
}

================
File: app/Providers/RouteServiceProvider.php
================
<?php

namespace App\Providers;

use Illuminate\Cache\RateLimiting\Limit;
use Illuminate\Foundation\Support\Providers\RouteServiceProvider as ServiceProvider;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\RateLimiter;
use Illuminate\Support\Facades\Route;

class RouteServiceProvider extends ServiceProvider
{
    /**
     * The path to your application's "home" route.
     *
     * Typically, users are redirected here after authentication.
     *
     * @var string
     */
    public const HOME = '/home';
    protected $namespace = 'App\\Http\\Controllers';

    /**
     * Define your route model bindings, pattern filters, and other route configuration.
     */
    public function boot(): void
    {
        RateLimiter::for('api', function (Request $request) {
            return Limit::perMinute(60)->by($request->user()?->id ?: $request->ip());
        });

        $this->routes(function () {

            Route::middleware('api')
                ->namespace($this->namespace)
                ->prefix('api')
                ->group(base_path('routes/api.php'));

            Route::middleware('api')
                ->namespace($this->namespace)
                ->prefix('api/recruitment')
                ->group(base_path('routes/recruitment/api.php'));

            Route::middleware('web')
                ->namespace($this->namespace)
                ->group(base_path('routes/web.php'));

            Route::namespace($this->namespace)
                ->group(base_path('routes/frontend.php'));

            Route::middleware('admin')
                ->namespace($this->namespace)
                ->prefix('recruitment')
                ->group(base_path('routes/recruitment/admin.php'));

            Route::middleware('personnel')
                ->namespace($this->namespace)
                ->prefix('personnel')
                ->group(base_path('routes/personnel/personnel.php'));

            Route::middleware('admin')
                ->namespace($this->namespace)
                ->prefix('plc')
                ->group(base_path('routes/plc/admin.php'));

            Route::middleware('admin')
                ->namespace($this->namespace)
                ->group(base_path('routes/admin.php'));
        });
    }
}

================
File: app/Repositories/Plc/MachineRepository.php
================
<?php

namespace App\Repositories\Plc;

use App\Repositories\Support\AbstractRepository;

class MachineRepository extends AbstractRepository {

    public function __construct(\Illuminate\Container\Container $app) {
        parent::__construct($app);
    }

    public function model() {
        return 'App\Models\Machine';
    }

    public function validateCreate() {
        return $rules = [
            'name' => 'required|max:100',
            'code' => 'required|max:50|unique:machine',
            'ip_address' => 'required|unique:machine',
            'description' => 'nullable',
            'status' => 'boolean'
        ];
    }

    public function validateUpdate($id) {
        return $rules = [
            'name' => 'required|max:100',
            'code' => 'required|max:50|unique:machine,code,' . $id . ',id',
            'ip_address' => 'required|unique:machine,ip_address,' . $id . ',id',
            'description' => 'nullable',
            'status' => 'boolean'
        ];
    }

    public function getActiveMachines()
    {
        return $this->model->active()->orderBy('name')->get();
    }

    public function toggleStatus($id)
    {
        $machine = $this->find($id);
        $machine->status = !$machine->status;
        $machine->save();
        return $machine;
    }
}

================
File: app/Repositories/Plc/MachineThresholdRepository.php
================
<?php

namespace App\Repositories\Plc;

use App\Models\MachineThreshold;
use App\Repositories\Support\AbstractRepository;

class MachineThresholdRepository extends AbstractRepository
{
    public function model()
    {
           return 'App\Models\MachineThreshold';
    }

   public function validateCreate()
    {
        return [
           'machine_id' => 'required|exists:machine,id',
           'name' => 'required|string',
           'plc_data_key' => 'required|string',
           'type' => 'required|in:boolean,parameter',
           'value' => 'nullable|required_if:type,boolean|in:0,1',
           'min_value' => 'nullable|numeric',
           'max_value' => 'nullable|required_if:type,parameter|numeric|gt:min_value',
           'warning_min_value' => 'nullable|string',
           'warning_max_value' => 'nullable|required_if:type,parameter|string'
        ];
    }

    public function validateUpdate($id)
    {
        $rules = $this->validateCreate();
        return $rules;
    }

    public function getByMachine($machineId)
    {
        return $this->model
            ->where('machine_id', $machineId)
            ->get();
    }

    public function getActiveChartParameters($machineId)
    {
        return $this->model
            ->where('machine_id', $machineId)
            ->where('is_active', true)
            ->where('show_on_chart', true)
            ->pluck('plc_data_key')
            ->toArray();
    }
}

================
File: app/Repositories/Support/AbstractRepository.php
================
<?php

namespace App\Repositories\Support;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Container\Container as App;
use Validator;
use Illuminate\Http\Request;
use Illuminate\Database\Eloquent\Builder;

abstract class AbstractRepository
{

    private $app;
    protected $model;

    public function __construct(App $app)
    {
        $this->app = $app;
        $this->makeModel();
    }

    /**
     *
     */
    abstract function model();

    /**
     *
     * @return type
     * @throws RepositoryException
     */
    public function makeModel()
    {
        $model = $this->app->make($this->model());
        if (!$model instanceof Model) {
            throw new RepositoryException("Class {$this->model()} must be an instance of Illuminate\\Database\\Eloquent\\Model");
        }
        return $this->model = $model;
    }

    /**
     * @param array $columns
     * @return mixed
     */
    public function all($columns = array('*'))
    {
        return $this->model->orderBy('created_at', 'DESC')->get();
    }

    public function getAll($limit = 10, $offset = 0)
    {
        return $this->model->limit($limit)->offset($offset)->get();
    }

    public function getActive($columns = array('*'))
    {
        return $this->model->where('active', 1)->orderBy('created_at', 'DESC')->get($columns);
    }

    public function getBy($attribute, $value, $orderBy = 'desc', $columns = array('*'))
    {
        return $this->model->where($attribute, '=', $value)->orderBy('created_at', $orderBy)->get($columns);
    }

    public function getExcept($id)
    {
        return $this->model->where('id', '!=', $id)->orderBy('created_at', 'DESC')->get();
    }

    public function count($columns = array('*'))
    {
        return $this->model->count();
    }

    public function countBy($attribute, $value)
    {
        return $this->model->where($attribute, '=', $value)->count();
    }

    public function allOrder($columns = array('*'))
    {
        return $this->model->orderBy('order', 'ASC')->orderBy('created_at', 'DESC')->get($columns);
    }

    public function selectArr()
    {
        $arr = [];
        $models = self::all();
        foreach ($models as $model) {
            $arr[$model->id] = $model->name;
        }
        return $arr;
    }

    public function queryAll()
    {
        return $this->model;
    }

    /**
     * @param int $perPage
     * @param array $columns
     * @return mixed
     */
    public function paginate($request = null, $perPage = 15, $columns = array('*'))
    {
        $query = $this->queryAll();
        if ($request !== NULL) {
            $sortBy = $request->get('sortBy');
            $orderBy = $request->get('orderBy');
            $searchBy = $request->get('searchBy');
            $searchText = $request->get('searchText');
            if (!is_null($sortBy) && $this->checkColumn($sortBy)) {
                $orderBy = in_array($orderBy, ['asc', 'desc']) ? $orderBy : 'asc';
                $query = $query->orderBy($sortBy, $orderBy);
            }
            if (!is_null($searchBy) && $this->checkColumn($searchBy)) {
                $query = $query->where($searchBy, 'LIKE', "%$searchText%");
            }
        }
        return $query->orderBy('id', 'DESC')->paginate($perPage, $columns);
    }

    /**
     * Delete a Eloquent model
     * @param $id
     * @return mixed
     */
    public function delete($id)
    {
        $model = $this->model->find($id);
        $model->delete();
    }

    public function destroy($id)
    {
        $model = $this->model->find($id);
        $model->delete();
    }

    /**
     * @param $id
     * @param array $columns
     * @return mixed
     */
    public function find($id, $columns = array('*'))
    {
        return $this->model->find($id, $columns);
    }

    public function findFirst($columns = array('*'))
    {
        return $this->model->first($columns);
    }

    public function getIn($attribute, $array = array('*'), $columns = array('*'))
    {
        return $this->model->whereIn($attribute, $array)->get($columns);
    }

    // public function findIn($attribute, $array = array('*'), $columns = array('*'))
    // {
    //     return $this->model->whereIn($attribute, $array)->get($columns);
    // }
    public function findBy($attribute, $value)
    {
        return $this->model->where($attribute, $value)->first();
    }
    public function findByPluck($attribute, $value, $pluck = '')
    {
        return $this->model->where($attribute, $value)->pluck($pluck)->first();
    }
    public function updateViewCount($id, $view_count)
    {
        return $this->model->where('id', $id)->update(['view_count' => $view_count + 1]);
    }
    public function findByAlias($alias)
    {
        return $this->model->where('alias', '=', $alias)->first();
    }
    /**
     * Clean data before use
     * @param array $data
     * @param array $unsetList
     * @return array
     */
    public function clean(array $data, array $unsetList = [], array $checkboxs = [])
    {
        foreach ($unsetList as $u) {
            unset($data[$u]);
        }

        unset($data['_method']);
        unset($data['_token']);

        foreach ($checkboxs as $checkbox) {
            if (!isset($data[$checkbox])) {
                $data[$checkbox] = 0;
            }
        }
        return $data;
    }

    /**
     *
     * @param type $length
     * @return type
     */
    function generateRandomString($code, $length = 10)
    {
        $characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ' . $code;
        $charactersLength = strlen($characters);
        $randomString = '';
        for ($i = 0; $i < $length; $i++) {
            $randomString .= $characters[rand(0, $charactersLength - 1)];
        }
        return $randomString;
    }

    protected function getTableColumns()
    {
        $modelColumns = $this->model->getTableColumns();
        return $modelColumns;
    }

    protected function checkColumn($col)
    {
        if (in_array($col, $this->getTableColumns())) {
            return true;
        } else {
            return false;
        }
    }

    public function create(array $data)
    {
        $model = $this->model->create($data);
        return $model;
    }

    public function createMany(array $data)
    {
        $model = $this->model->createMany($data);
        return $model;
    }

    /**
     * @param array $data
     * @param $id
     * @param string $attribute
     * @return mixed
     */
    public function update(array $data, $id)
    {
        $model = true;
        if (isset($data)) {
            $model = $this->model->find($id)
                ->update($data);
        }
        return $model;
    }

    public function weekdays()
    {
        return array(
            1 => trans('base.monday'),
            2 => trans('base.tuesday'),
            3 => trans('base.wednesday'),
            4 => trans('base.wednesday'),
            5 => trans('base.thursday'),
            6 => trans('base.friday'),
            7 => trans('base.saturday'),
            8 => trans('base.sunday'),
        );
    }

    public function toggle($id, $field = 'status')
    {
        $model = $this->find($id);
        $this->model->where('id', '=', $id)->update([$field => (string) (1 - ($model->$field))]);
        return true;
    }
    public function search(Request $request, $perPage = 15)
    {
        $query = $this->model->query();

        //Nhồi các tham số search vào query
        $this->applySearch($query, $request);

        $sqlWithPlaceholders = $query->toSql();
        $bindings = $query->getBindings();
        $realSql = $this->replacePlaceholdersWithBindings($sqlWithPlaceholders, $bindings);
        //dd($realSql);

        return $query->orderBy('id', 'desc')->paginate($perPage);
    }
    //Check query
    protected function replacePlaceholdersWithBindings($sql, $bindings)
    {
        foreach ($bindings as $binding) {
            $value = is_numeric($binding) ? $binding : "'" . addslashes($binding) . "'";
            $sql = preg_replace('/\?/', $value, $sql, 1);
        }

        return $sql;
    }

    protected function applySearch(Builder $query, Request $request)
    {
        $fieldMetadata = $this->model->getFieldMetadata();

        foreach ($request->all() as $field => $value) {
            if (!empty($value)) {
                foreach ($fieldMetadata as $metadata) {
                    if ($metadata['field'] == $field && isset($metadata['search']) && $metadata['search']) {
                        $type = $metadata['type'] ?? 'text';

                        switch ($type) {
                            case 'string':
                            case 'text':
                                $query->where($field, 'like', '%' . $value . '%');
                                break;

                            case 'number':
                                $query->where($field, $value);
                                break;

                            case 'email':
                                $query->where($field, 'like', '%' . $value . '%');
                                break;

                            case 'date':
                                $query->whereDate($field, '=', $value);
                                break;

                            case 'datetime-local':
                            case 'datetime':
                                $query->where($field, '=', $value);
                                break;

                            case 'boolean':
                            case 'checkbox':
                                $value = ($value == 'true' || $value == '1') ? 1 : 0;
                                $query->where($field, '=', $value);
                                break;

                            case 'date-range':
                                if (isset($metadata['start_field']) && isset($metadata['end_field'])) {
                                    $startDate = $request->get($metadata['start_field']);
                                    $endDate = $request->get($metadata['end_field']) ?: now()->toDateString();
                                    if ($startDate && $endDate) {
                                        $query->whereBetween($field, [$startDate, $endDate]);
                                    }
                                }
                                break;

                            default:
                                $query->where($field, 'like', '%' . $value . '%');
                                break;
                        }
                        break;
                    }
                }
            }
        }
    }
}

================
File: app/Repositories/Support/Exceptions.php
================
<?php

namespace Nc\Support;

class RepositoryException extends \UnexpectedValueException {};

================
File: app/Services/PlcDataService.php
================
<?php
namespace App\Services;

use App\Models\Machine;
use App\Models\PlcData;
use Illuminate\Support\Facades\Http;
use Symfony\Component\DomCrawler\Crawler;

class PlcDataService
{
    protected $machine;

    public function __construct()
    {
        // Constructor không cần khởi tạo URL nữa
    }

    public function crawlData($machine_id)
    {
        try {
            $machine = Machine::findOrFail($machine_id);
            $url = $machine->ip_address;

            $response = Http::get($url);

            if ($response->successful()) {
                $crawler = new Crawler($response->body());

                // Get table rows
                $rows = $crawler->filter('#watch_table tr.var');
                $data = [];

                // Extract data from rows
                $rows->each(function (Crawler $row) use (&$data) {
                    $name = $row->filter('td')->eq(0)->text();
                    $value = $row->filter('td')->eq(3)->text();

                    // Clean up the name and value
                    $name = trim(str_replace('"', '', $name));
                    $value = trim($value);

                    if ($value && !str_contains($value, 'no_scope')) {
                        $data[$this->normalizeKey($name)] = $this->parseValue($value);
                    }
                });

                // Map data với đầy đủ các trường
                $mappedData = [
                    'machine_id' => $machine_id,
                    'date' => now()->toDateString(),
                    'ca' => str_replace("'", "", $data['Datalog.DATA.Ca'] ?? 'CA1'),
                    'trang_thai' => str_replace("'", "", $data['DATA.Trạng_thái'] ?? null),

                    // Thông tin công nhân và sản phẩm
                    'cn1' => str_replace("'", "", $data['Datalog.DATA.CN1'] ?? null),
                    'cn2' => str_replace("'", "", $data['Datalog.DATA.CN2'] ?? null),
                    'to' => str_replace("'", "", $data['Datalog.DATA.TO'] ?? null),
                    'ma_sp' => str_replace("'", "", $data['Datalog.DATA.MA_SP'] ?? null),
                    'nl1' => str_replace("'", "", $data['Datalog.DATA.NL1'] ?? null),
                    'nl2' => str_replace("'", "", $data['Datalog.DATA.NL2'] ?? null),
                    'nl_chi' => str_replace("'", "", $data['Datalog.DATA.NL_CHI'] ?? null),
                    'mau_chi' => str_replace("'", "", $data['Datalog.DATA.MAU_CHI'] ?? null),
                    'ma_dh' => str_replace("'", "", $data['Datalog.DATA.MA_DH'] ?? null),
                    'thn' => str_replace("'", "", $data['Datalog.DATA.THN'] ?? null),
                    'tht' => str_replace("'", "", $data['Datalog.DATA.THT'] ?? null),
                    'chuot' => str_replace("'", "", $data['Datalog.DATA.CHUOT'] ?? null),

                    // Thông số vận hành
                    'toc_do_vx' => $data['Tốc_độ_thực_tế_VX'] ?? null,
                    'toc_do_may_chi' => $data['Tốc_độ_thực_tế_máy_chỉ'] ?? null,
                    'toc_do_dan_keo' => $data['Tốc_độ_thực_tế_dàn_kéo_m/p'] ?? null,
                    'toc_do_dat_vx' => $data['Tốc_độ_đặt_VX'] ?? null,
                    'toc_do_dat_may_chi' => $data['Tốc_độ_đặt_máy_chỉ'] ?? null,
                    'toc_do_dat_dan_keo' => $data['Tốc_độ_đặt_dàn_kéo'] ?? null,
                    'ap_luc_nhua' => $data['Ápp_lực_nhựa'] ?? null,
                    'nhiet_do_nhua' => $data['Nhiệt_độ_nhựa'] ?? null,
                    'tai_thuc_te_dc_chinh' => $data['Tải_thực_tế_DC_chính'] ?? null,
                    'tai_thuc_te_may_chi' => $data['Tải_thực_tế_máy_chỉ'] ?? null,
                    'can_thuc_te' => $data['Cân_thực_tế'] ?? null,
                    'nang_suat' => $data['Năng_suất(kg/h)'] ?? null,
                    'dinh_luong_gm' => $data['Định_lượng_g/m'] ?? null,
                    'dinh_luong_dat_gm' => $data['Định_lượng_đặt_g/m'] ?? null,
                    'toc_do_dat_bom_ck' => $data['HMI_tốc_độ_đặt_bơm_CK'] ?? null,

                    // Nhiệt độ XL và CN
                    'nhiet_do_co_cl' => $data['Nhiệt_độ_thực_tế_cổ_CL'] ?? null,
                    'nhiet_do_xl_1' => $data['Nhiệt_độ_thực_tế_XL_1'] ?? null,
                    'nhiet_do_xl_2' => $data['Nhiệt_độ_thực_tế_XL_2'] ?? null,
                    'nhiet_do_xl_3' => $data['Nhiệt_độ_thực_tế_XL_3'] ?? null,
                    'nhiet_do_xl_4' => $data['Nhiệt_độ_thực_tế_XL_4'] ?? null,
                    'nhiet_do_xl_5' => $data['Nhiệt_độ_thực_tế_XL_5'] ?? null,
                    'nhiet_do_cn' => $data['Nhiệt_độ_thực_tế_CN'] ?? null,

                    // Nhiệt độ các ĐH
                    'nhiet_do_dh_1' => $data['Nhiệt_độ_thực_tế_ĐH_1'] ?? null,
                    'nhiet_do_dh_2' => $data['Nhiệt_độ_thực_tế_ĐH_2'] ?? null,
                    'nhiet_do_dh_3' => $data['Nhiệt_độ_thực_tế_ĐH_3'] ?? null,
                    'nhiet_do_dh_4' => $data['Nhiệt_độ_thực_tế_ĐH_4'] ?? null,
                    'nhiet_do_dh_5' => $data['Nhiệt_độ_thực_tế_ĐH_5'] ?? null,
                    'nhiet_do_dh_6' => $data['Nhiệt_độ_thực_tế_ĐH_6'] ?? null,
                    'nhiet_do_dh_7' => $data['Nhiệt_độ_thực_tế_ĐH_7'] ?? null,
                    'nhiet_do_dh_8' => $data['Nhiệt_độ_thực_tế_ĐH_8'] ?? null,
                    'nhiet_do_dh_9' => $data['Nhiệt_độ_thực_tế_ĐH_9'] ?? null,
                    'nhiet_do_dh_10' => $data['Nhiệt_độ_thực_tế_ĐH_10'] ?? null,
                    'nhiet_do_dh_11' => $data['Nhiệt_độ_thực_tế_ĐH_11'] ?? null,
                    'nhiet_do_dh_12' => $data['Nhiệt_độ_thực_tế_ĐH_12'] ?? null,

                    // Nhiệt độ máy chỉ
                    'nhiet_do_may_chi_xl_1' => $data['Nhiệt_độ_thực_tế_máy_chỉ_XL_1'] ?? null,
                    'nhiet_do_may_chi_xl_2' => $data['Nhiệt_độ_thực_tế_máy_chỉ_XL_2'] ?? null,
                    'nhiet_do_may_chi_xl_3' => $data['Nhiệt_độ_thực_tế_máy_chỉ_XL_3'] ?? null,
                    'nhiet_do_may_chi_xl_4' => $data['Nhiệt_độ_thực_tế_máy_chỉ_XL_4'] ?? null,

                    // Thông số vacuum và CK
                    'nhiet_do_nuoc_vacuum_1' => $data['Nhiệt_độ_nước_vacuum_1'] ?? null,
                    'nhiet_do_nuoc_vacuum_2' => $data['Nhiệt_độ_nước_vacuum_2'] ?? null,
                    'ap_suat_be_ck1' => $data['Áp_suất_bể_CK1'] ?? null,

                    // Thời gian
                    'gio_dung' => (int)($data['Datalog.DATA.Gio_dung'] ?? 0),
                    'gio_gia_nhiet' => (int)($data['Datalog.DATA.Gio_gia_nhiet'] ?? 0),
                    'gio_chay_1' => (int)($data['Datalog.DATA.Gio_chay_1'] ?? 0),
                    'gio_chay_2' => (int)($data['Datalog.DATA.Gio_chay_2'] ?? 0),
                ];

                return PlcData::create($mappedData);
            }

            return null;
        } catch (\Exception $e) {
            \Log::error("Lỗi crawl data từ máy {$machine_id}: " . $e->getMessage());
            return null;
        }
    }

    protected function normalizeKey($key)
    {
        return str_replace([' ', '"'], ['_', ''], $key);
    }

    protected function parseValue($value)
    {
        // Xử lý các giá trị boolean
        if (str_contains($value, 'true') || str_contains($value, 'false')) {
            return str_contains($value, 'true');
        }

        // Xử lý giá trị số
        if (is_numeric($value)) {
            return (float) $value;
        }

        return $value;
    }
}

================
File: resources/views/auth/login.blade.php
================
@extends('recruitment.layouts.master_content')
@section('content')
    <div class="login-box">
        <div class="login-logo">
            <a href="{{route('auth.get_login')}}"><b>Đăng nhập</b> hệ thống</a>
        </div>
        <!-- /.login-logo -->
        <div class="card">
            <div class="card-body login-card-body">
                <p class="login-box-msg">Vui lòng nhập tài khoản và mật khẩu</p>

                <form action="{{ route('auth.login') }}" method="post">
                    @csrf
                    <div class="input-group mb-3">
                        <input type="text" name="code" required class="form-control" placeholder="Tài khoản">
                        <div class="input-group-append">
                            <div class="input-group-text">
                                <span class="fas fa-user"></span>
                            </div>
                        </div>
                    </div>
                    <div class="input-group mb-3">
                        <input type="password" name="password" required class="form-control" placeholder="Mật khẩu">
                        <div class="input-group-append">
                            <div class="input-group-text">
                                <span class="fas fa-lock"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        {{--                    <div class="col-8"> --}}
                        {{--                        <div class="icheck-primary"> --}}
                        {{--                            <input type="checkbox" id="remember"> --}}
                        {{--                            <label for="remember"> --}}
                        {{--                                Remember Me --}}
                        {{--                            </label> --}}
                        {{--                        </div> --}}
                        {{--                    </div> --}}
                        <!-- /.col -->
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary btn-block">Đăng nhập</button>
                        </div>
                        <!-- /.col -->
                    </div>
                </form>

                {{--            <div class="social-auth-links text-center mb-3"> --}}
                {{--                <p>- OR -</p> --}}
                {{--                <a href="#" class="btn btn-block btn-primary"> --}}
                {{--                    <i class="fab fa-facebook mr-2"></i> Sign in using Facebook --}}
                {{--                </a> --}}
                {{--                <a href="#" class="btn btn-block btn-danger"> --}}
                {{--                    <i class="fab fa-google-plus mr-2"></i> Sign in using Google+ --}}
                {{--                </a> --}}
                {{--            </div> --}}
                <!-- /.social-auth-links -->

                {{-- <p class="mb-1">
                <a href="{{route('auth.forget_password')}}">Quên mật khẩu</a>
            </p> --}}
                {{--            <p class="mb-0"> --}}
                {{--                <a href="register.html" class="text-center">Register a new membership</a> --}}
                {{--            </p> --}}
            </div>
            <!-- /.login-card-body -->
        </div>
    </div>
    <!-- /.login-box -->
@stop

================
File: resources/views/plc/chart/show.blade.php
================
@extends('plc.layouts.master')

@section('content')
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="card-title">Biểu đồ cho máy #{{ $machineId }}</h3>
        <div class="btn-group">
            <button type="button" class="btn btn-sm btn-primary" data-range="24h">24h</button>
            <button type="button" class="btn btn-sm btn-default" data-range="7d">7 ngày</button>
            <button type="button" class="btn btn-sm btn-default" data-range="30d">30 ngày</button>
        </div>
    </div>
    <div class="card-body">
        <div id="plcChart" style="height: 600px;"></div>
    </div>
</div>

<script>
$(function() {
    let currentRange = '24h';

    const chart = $("#plcChart").dxChart({
        dataSource: [],
        commonSeriesSettings: {
            argumentField: 'timestamp',
            type: 'spline',
            point: { visible: true, size: 6 }
        },
        series: [
            @foreach($thresholds as $th)
                {
                    name: '{{ $th['name'] }}',
                    valueField: '{{ $th['plc_data_key'] }}',
                    color: '{{ $th['color'] }}'
                },
            @endforeach
        ],
        argumentAxis: {
            argumentType: "datetime",
            label: { format: "yyyy-MM-dd HH:mm" },
            grid: { visible: true }
        },
        valueAxis: {
            grid: { visible: true }
        },
        tooltip: {
            enabled: true,
            shared: true,
            customizeTooltip: function(args) {
                const lines = args.points.map(pt => {
                    return `${pt.seriesName}: ${pt.value !== undefined ? pt.value.toFixed(2) : 'N/A'}`;
                });
                return { text: lines.join('<br/>') };
            }
        },
        legend: { verticalAlignment: "bottom", horizontalAlignment: "center" },
        export: { enabled: true },
        zoomAndPan: { argumentAxis: "both", valueAxis: "both" },
        scrollBar: { visible: true },
        annotations: []
    }).dxChart("instance");

    function loadChartData(range) {
        $.ajax({
            url: '{{ route("plc.chart.data", $machineId) }}',
            data: { range: range },
            success: function(res) {
                if (res.success && res.data) {
                    // parse timestamp
                    res.data.forEach(item => {
                        if (item.timestamp) {
                            item.timestamp = new Date(item.timestamp.replace(' ', 'T'));
                        }
                    });
                    chart.option("dataSource", res.data);

                    // Tạo annotation cảnh báo
                    const annotations = [];
                    const thresholdMap = res.thresholds || {};

                    res.data.forEach(row => {
                        Object.keys(thresholdMap).forEach(key => {
                            const th = thresholdMap[key];
                            const val = row[key];
                            if (val !== undefined && val !== null) {
                                if ((th.min_value !== null && val < th.min_value) ||
                                    (th.max_value !== null && val > th.max_value)) {
                                    annotations.push({
                                        argument: row.timestamp,
                                        value: val,
                                        text: `Cảnh báo ${th.name}\nGiá trị: ${val}\n[${th.min_value} - ${th.max_value}]`,
                                        color: '#FF0000',
                                        border: { color: '#FF0000' },
                                        font: { color: '#FFFFFF' },
                                        arrowLength: 10,
                                        offsetX: 0,
                                        offsetY: -15
                                    });
                                }
                            }
                        });
                    });
                    chart.option("annotations", annotations);
                }
            }
        });
    }

    // Load lần đầu
    loadChartData(currentRange);

    // Khi bấm nút
    $('.btn-group .btn').click(function() {
        $(this).addClass('btn-primary').removeClass('btn-default')
               .siblings().addClass('btn-default').removeClass('btn-primary');
        currentRange = $(this).data('range');
        loadChartData(currentRange);
    });

    // Auto refresh 10s
    setInterval(() => {
        loadChartData(currentRange);
    }, 10000);
});
</script>
@endsection

================
File: resources/views/plc/layouts/_footer_content.blade.php
================
<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Tiền Phong HRM</title>

    <script src="{{ asset('assets/view/adminlte/plugins/jquery/jquery.min.js') }}"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="{{ asset('assets/view/adminlte/plugins/jquery-ui/jquery-ui.min.js') }}"></script>
    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/fontawesome-free/css/all.min.css') }} ">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Bootstrap Color Picker -->
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css') }}">
    <!-- Select2 -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/select2/css/select2.min.css') }}">
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css') }}">
    <!-- Bootstrap4 Duallistbox -->
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css') }}">
    <!-- BS Stepper -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/bs-stepper/css/bs-stepper.min.css') }}">
    <!-- dropzonejs -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/dropzone/min/dropzone.min.css') }}">
    <!-- Tempusdominus Bootstrap 4 -->
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css') }}">
    <!-- iCheck -->
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/icheck-bootstrap/icheck-bootstrap.min.css') }}">
    <!-- JQVMap -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/jqvmap/jqvmap.min.css') }}">
    <!-- Theme style -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/dist/css/adminlte.min.css') }}">
    <!-- overlayScrollbars -->
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/overlayScrollbars/css/OverlayScrollbars.min.css') }}">
    <!-- Daterange picker -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/daterangepicker/daterangepicker.css') }}">
    <!-- summernote -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/summernote/summernote-bs4.min.css') }}">
    <link href="smart_wizard.min.css" rel="stylesheet">
    {{-- devxtreme --}}
    <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/23.1.4/css/dx.common.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/23.1.4/css/dx.light.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/23.1.4/css/dx-diagram.css" />
    <!--Step to step -->
    {{-- <link href="{{ asset('lib/step-to-step/css/smart_wizard_round.min.css') }}" rel="stylesheet">
    <link href="{{ asset('lib/step-to-step/css/smart_wizard_arrows.min.css') }}" rel="stylesheet">
    <link href="{{ asset('lib/step-to-step/css/smart_wizard_dots.min.css') }}" rel="stylesheet"> --}}
    <link href="{{ asset('lib/my-step-to-step/css/my-step.css') }}" rel="stylesheet">
    <link href="{{ asset('lib/my-step-to-step/css/my-step-arrows.css') }}" rel="stylesheet">
    <link href="{{ asset('lib/my-step-to-step/css/responsive-multiple-step.css') }}" rel="stylesheet">
    <!-- Cài đặt thư viện Globalize -->
    <!-- Cài đặt ngôn ngữ tiếng Việt -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/globalize/1.7.0/globalize/cultures/globalize.culture.vi.min.js">
    </script>

    {{-- devxtreme --}}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"
        integrity="sha512-XMVd28F1oH/O71fzwBnV7HucLxVwtxf26XV8P4wPk26EDxuGZ91N8bsOttmnomcCD3CS5ZMRL50H0GgOHvegtg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn3.devexpress.com/jslib/23.1.4/js/dx-diagram.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/devextreme/22.2.6/js/dx.all.js"></script>
    {{-- <script src="https://cdn3.devexpress.com/jslib/23.1.4/js/dx.all.js"></script> --}}
    {{-- <script src="{{ asset('ckeditor/ckeditor.js') }}"></script> --}}
    <script src="https://cdn.ckeditor.com/4.16.0/full-all/ckeditor.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-database.js"></script>
    {{-- <script>
        //Tiếng việt cho date
        DevExpress.localization.locale("vi");

        //Validate vietsub
        DevExpress.localization.addCultureInfo("vi", {
            messages: {
                "dxValidator-required": "Vui lòng nhập giá trị vào trường này.",
                "dxValidator-pattern": "Trường này không khớp với định dạng yêu cầu.",
                "dxValidator-email": "Vui lòng nhập địa chỉ email hợp lệ.",
                "dxValidator-url": "Vui lòng nhập URL hợp lệ.",
                "dxValidator-length": "Vui lòng nhập giá trị có độ dài phù hợp.",
                "dxValidator-range": "Vui lòng nhập giá trị trong phạm vi hợp lệ.",
                "dxValidator-compare": "Giá trị không khớp.",
                "dxValidator-custom": "Giá trị không hợp lệ.",
                "dxValidator-numeric": "Vui lòng nhập giá trị số.",
                "dxValidator-numericMin": "Giá trị phải lớn hơn hoặc bằng {0}.",
                "dxValidator-numericMax": "Giá trị phải nhỏ hơn hoặc bằng {0}.",
                "dxValidator-numericMinMax": "Giá trị phải nằm trong khoảng từ {0} đến {1}.",
                "dxValidator-rangeMin": "Giá trị phải lớn hơn hoặc bằng {0}.",
                "dxValidator-rangeMax": "Giá trị phải nhỏ hơn hoặc bằng {0}.",
                "dxValidator-rangeMinMax": "Giá trị phải nằm trong khoảng từ {0} đến {1}.",
                "dxValidator-stringLengthMin": "Độ dài của chuỗi phải lớn hơn hoặc bằng {0} ký tự.",
                "dxValidator-stringLengthMax": "Độ dài của chuỗi phải nhỏ hơn hoặc bằng {0} ký tự.",
                "dxValidator-stringLengthMinMax": "Độ dài của chuỗi phải nằm trong khoảng từ {0} đến {1} ký tự.",
                "dxValidator-customFunc": "Giá trị không hợp lệ.",
                "dxDateBox-validation-datetime": "Vui lòng nhập ngày tháng hợp lệ.",
                "dxDateBox-validation-nullable": "Vui lòng nhập giá trị vào trường này.",
                "dxTextArea-validation-length": "Vui lòng nhập giá trị có độ dài phù hợp.",
                "dxTextArea-validation-range": "Vui lòng nhập giá trị trong phạm vi hợp lệ.",
                "dxTextArea-validation-numeric": "Vui lòng nhập giá trị số.",
                "dxTextArea-validation-numericMin": "Giá trị phải lớn hơn hoặc bằng {0}.",
                "dxTextArea-validation-numericMax": "Giá trị phải nhỏ hơn hoặc bằng {0}.",
                "dxTextArea-validation-numericMinMax": "Giá trị phải nằm trong khoảng từ {0} đến {1}.",
                "dxTextArea-validation-rangeMin": "Giá trị phải lớn hơn hoặc bằng {0}.",
                "dxTextArea-validation-rangeMax": "Giá trị phải nhỏ hơn hoặc bằng {0}.",
                "dxTextArea-validation-rangeMinMax": "Giá trị phải nằm trong khoảng từ {0} đến {1}.",
                "dxTextArea-validation-stringLengthMin": "Độ dài của chuỗi phải lớn hơn hoặc bằng {0} ký tự.",
                "dxTextArea-validation-stringLengthMax": "Độ dài của chuỗi phải nhỏ hơn hoặc bằng {0} ký tự.",
                "dxTextArea-validation-stringLengthMinMax": "Độ dài của chuỗi phải nằm trong khoảng từ {0} đến {1} ký tự.",
                "dxTextArea-validation-customFunc": "Giá trị không hợp lệ.",
                "dxFileUploader-validation-datatype": "Loại tệp không hợp lệ.",
                "dxFileUploader-validation-size": "Kích thước tệp quá lớn.",
                "dxFileUploader-validation-minSize": "Kích thước tệp quá nhỏ.",
                "dxFileUploader-validation-maxSize": "Kích thước tệp quá lớn.",
                "dxFileUploader-validation-invalidMaxFileSizeMessage": "Kích thước tệp vượt quá giới hạn được chỉ định.",
                "dxFileUploader-validation-invalidMinFileSizeMessage": "Kích thước tệp nhỏ hơn giới hạn được chỉ định.",
                "dxFileUploader-validation-invalidFileExtensionMessage": "Loại tệp không hợp lệ.",
                "dxRangeSlider-unsupported-type": "Kiểu dữ liệu không hỗ trợ.",
                "dxRangeSlider-unsupported-minValue": "MinValue không hỗ trợ.",
                "dxRangeSlider-unsupported-maxValue": "MaxValue không hỗ trợ.",
                "dxSwitch-onText": "Bật",
                "dxSwitch-offText": "Tắt",
                "dxForm-optionalMark": "tùy chọn"

            }
        });
    </script> --}}

================
File: resources/views/plc/layouts/_footer.blade.php
================
<!-- /.content-wrapper -->
  {{--  <footer class="main-footer"> --}}
  {{--    <strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> --}}
  {{--    All rights reserved. --}}
  {{--    <div class="float-right d-none d-sm-inline-block"> --}}
  {{--      <b>Version</b> 3.2.0 --}}
  {{--    </div> --}}
  {{--  </footer> --}}


  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <script>
      $.widget.bridge('uibutton', $.ui.button)
  </script>

  <!-- Bootstrap 4 -->
  <script src="{{ asset('assets/view/adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
  <!-- Select2 -->
  <script src="{{ asset('assets/view/adminlte/plugins/select2/js/select2.full.min.js') }}"></script>
  <!-- Bootstrap4 Duallistbox -->
  <script src="{{ asset('assets/view/adminlte/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js') }}">
  </script>
  <!-- ChartJS -->
  <script src="{{ asset('assets/view/adminlte/plugins/chart.js/Chart.min.js') }}"></script>
  <!-- Sparkline -->
  <script src="{{ asset('assets/view/adminlte/plugins/sparklines/sparkline.js') }}"></script>
  <!-- JQVMap -->
  {{-- <script src="{{ asset('assets/view/adminlte/plugins/jqvmap/jquery.vmap.min.js') }}"></script>
<script src="{{ asset('assets/view/adminlte/plugins/jqvmap/maps/jquery.vmap.usa.js') }}"></script> --}}
  <!-- InputMask -->
  <script src="{{ asset('assets/view/adminlte/plugins/inputmask/jquery.inputmask.min.js') }}"></script>
  <!-- bootstrap color picker -->
  <script src="{{ asset('assets/view/adminlte/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js') }}">
  </script>
  <!-- Bootstrap Switch -->
  <script src="{{ asset('assets/view/adminlte/plugins/bootstrap-switch/js/bootstrap-switch.min.js') }}"></script>
  <!-- BS-Stepper -->
  <script src="{{ asset('assets/view/adminlte/plugins/bs-stepper/js/bs-stepper.min.js') }}"></script>
  <!-- dropzonejs -->
  <script src="{{ asset('assets/view/adminlte/plugins/dropzone/min/dropzone.min.js') }}"></script>
  <!-- jQuery Knob Chart -->
  <script src="{{ asset('assets/view/adminlte/plugins/jquery-knob/jquery.knob.min.js') }}"></script>
  <!-- daterangepicker -->
  <script src="{{ asset('assets/view/adminlte/plugins/moment/moment.min.js') }}"></script>
  <script src="{{ asset('assets/view/adminlte/plugins/daterangepicker/daterangepicker.js') }}"></script>
  <!-- Tempusdominus Bootstrap 4 -->
  <script
      src="{{ asset('assets/view/adminlte/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js') }}">
  </script>
  <!-- Summernote -->
  <script src="{{ asset('assets/view/adminlte/plugins/summernote/summernote-bs4.min.js') }}"></script>
  <!-- overlayScrollbars -->
  <script src="{{ asset('assets/view/adminlte/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js') }}">
  </script>
  <!-- AdminLTE App -->
  <script src="{{ asset('assets/view/adminlte/dist/js/adminlte.js') }}"></script>
  <!-- AdminLTE for demo purposes -->
  <script src="{{ asset('assets/view/adminlte/dist/js/demo.js') }}"></script>
  <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
  <script src="{{ asset('js/common.js') }}"></script>
  <!-- Add ckeditor-->
  {{-- <script src="https://cdn.ckeditor.com/ckeditor5/38.1.0/classic/ckeditor.js"></script> --}}
  {{-- <script>
    ClassicEditor
    .create( document.querySelector( '#ckeditor' ) )
    .then( editor => {
        console.log( editor );
    } )
    .catch( error => {
        console.error( error );
    } );
</script> --}}



  {{-- <script src="https://cdn.ckeditor.com/ckeditor5/36.0.0/classic/ckeditor.js"></script>
<script src="https://cdn.ckbox.io/ckbox/1.5.1/ckbox.js"></script>
<script src="https://cdn.ckbox.io/ckbox/1.5.1/translations/es.js"></script>
<link rel="stylesheet" href="https://cdn.ckbox.io/ckbox/1.5.1/styles/themes/dark.css">

<script>
    ClassicEditor
        .create( document.querySelector( '#ckeditor' ), {
            ckbox: {
                tokenUrl: 'https://your.token.url',
            },
            toolbar: [
                'ckbox', 'imageUpload', '|', 'heading', '|', 'undo', 'redo', '|', 'bold', 'italic', '|',
                'blockQuote', 'indent', 'link', '|', 'bulletedList', 'numberedList'
            ],
        } )
        .catch( error => {
            console.error( error );
        } );
</script> --}}

  <!-- Add js cho thư viện select2, datetime, color-->
  <script src="{{ asset('js/lib.js') }}"></script>

================
File: resources/views/plc/layouts/_head.blade.php
================
<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Tiền Phong HRM</title>

    <script src="{{ asset('assets/view/adminlte/plugins/jquery/jquery.min.js') }}"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="{{ asset('assets/view/adminlte/plugins/jquery-ui/jquery-ui.min.js') }}"></script>
    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/fontawesome-free/css/all.min.css') }} ">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Bootstrap Color Picker -->
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css') }}">
    <!-- Select2 -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/select2/css/select2.min.css') }}">
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css') }}">
    <!-- Bootstrap4 Duallistbox -->
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css') }}">
    <!-- BS Stepper -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/bs-stepper/css/bs-stepper.min.css') }}">
    <!-- dropzonejs -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/dropzone/min/dropzone.min.css') }}">
    <!-- Tempusdominus Bootstrap 4 -->
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css') }}">
    <!-- iCheck -->
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/icheck-bootstrap/icheck-bootstrap.min.css') }}">
    <!-- JQVMap -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/jqvmap/jqvmap.min.css') }}">
    <!-- Theme style -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/dist/css/adminlte.min.css') }}">
    <!-- overlayScrollbars -->
    <link rel="stylesheet"
        href="{{ asset('assets/view/adminlte/plugins/overlayScrollbars/css/OverlayScrollbars.min.css') }}">
    <!-- Daterange picker -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/daterangepicker/daterangepicker.css') }}">
    <!-- summernote -->
    <link rel="stylesheet" href="{{ asset('assets/view/adminlte/plugins/summernote/summernote-bs4.min.css') }}">
    <link href="smart_wizard.min.css" rel="stylesheet">
    {{-- devxtreme --}}
    <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/23.1.4/css/dx.common.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/23.1.4/css/dx.light.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/23.1.4/css/dx-diagram.css" />
    {{-- <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/23.1.4/css/dx.material.teal.light.css" />  --}}
    <!--Step to step -->
    {{-- <link href="{{ asset('lib/step-to-step/css/smart_wizard_round.min.css') }}" rel="stylesheet">
    <link href="{{ asset('lib/step-to-step/css/smart_wizard_arrows.min.css') }}" rel="stylesheet">
    <link href="{{ asset('lib/step-to-step/css/smart_wizard_dots.min.css') }}" rel="stylesheet"> --}}
    <link href="{{ asset('lib/my-step-to-step/css/my-step.css') }}" rel="stylesheet">
    <link href="{{ asset('lib/my-step-to-step/css/my-step-arrows.css') }}" rel="stylesheet">
    <link href="{{ asset('lib/my-step-to-step/css/responsive-multiple-step.css') }}" rel="stylesheet">
    <!-- Cài đặt thư viện Globalize -->
    <!-- Cài đặt ngôn ngữ tiếng Việt -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/globalize/1.7.0/globalize/cultures/globalize.culture.vi.min.js">
    </script>

    {{-- devxtreme --}}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"
        integrity="sha512-XMVd28F1oH/O71fzwBnV7HucLxVwtxf26XV8P4wPk26EDxuGZ91N8bsOttmnomcCD3CS5ZMRL50H0GgOHvegtg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn3.devexpress.com/jslib/23.1.4/js/dx-diagram.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/devextreme/22.2.6/js/dx.all.js"></script>
    {{-- <script src="https://cdn3.devexpress.com/jslib/23.1.4/js/dx.all.js"></script> --}}
    {{-- <script src="{{ asset('ckeditor/ckeditor.js') }}"></script> --}}
    <script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script>
    {{-- <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-database.js"></script> --}}
    <script>
        //Tiếng việt cho date
        DevExpress.localization.locale("vi");
    </script>

================
File: resources/views/plc/layouts/_header.blade.php
================
<!-- Content Header (Page header) -->
 <section class="content-header">
     <div class="container-fluid">
         <div class="row mb-2">
             <div class="col-sm-6">
                 <ol class="breadcrumb float-sm-left">
                     <li class="breadcrumb-item"><a href="{!! route('recruitment.index') !!}">Trang chủ</a></li>
                     {{-- @if ($method == 'index')
                         <li class="breadcrumb-item active">{{ trans('route.' . $parent_route) }}</li>
                     @else
                         @if (isset($type))
                             <li class="breadcrumb-item active"><a class="text-default"
                                     href="{!! route($parent_route, ['type' => $type]) !!}">{{ trans('route.' . $parent_route) }}</a></li>
                         @else
                             <li class="breadcrumb-item active"><a class="text-default"
                                     href="{!! route($parent_route) !!}">{{ trans('route.' . $parent_route) }}</a></li>
                         @endif
                         <li class="breadcrumb-item active">{{ trans('route.' . $method) }}</li>
                     @endif --}}
                 </ol>

             </div>
             <div class="col-sm-6">
                 {{-- <div class="float-sm-right">
                     @if ($parent_route !== 'recruitment.index')
                         @if ($method == 'index')
                             @if (\Route::has(str_replace('index', 'create', $current_route)) && strpos($current_route, 'index') != false)
                                 @if (isset($type))
                                     <a href="{!! route(str_replace('index', 'create', $current_route), ['type' => $type]) !!}" class="btn btn-link btn-float text-default"><i
                                             class="icon-googleplus5 text-primary"></i><span>Thêm mới</span></a>
                                 @else
                                     <a href="{!! route(str_replace('index', 'create', $current_route)) !!}" class="btn btn-link btn-float text-default"><i
                                             class="icon-googleplus5 text-primary"></i><span>Thêm mới</span></a>
                                 @endif
                             @endif
                         @else
                             @if (isset($type))
                                 <a href="{!! route($parent_route, ['type' => $type]) !!}" class="btn btn-link btn-float text-default"><i
                                         class="icon-square-left text-primary"></i><span>Quay lại</span></a>
                             @else
                                 <a href="{!! route($parent_route) !!}" class="btn btn-link btn-float text-default"><i
                                         class="icon-square-left text-primary"></i><span>Quay lại</span></a>
                             @endif
                         @endif
                     @endif
                     <div>
                     </div>
                 </div> --}}
             </div><!-- /.container-fluid -->
 </section>

 <!-- Main content -->

================
File: resources/views/plc/layouts/_navbar.blade.php
================
<!-- Navbar -->
 <nav class="main-header navbar navbar-expand navbar-white navbar-light">
     <!-- Left navbar links -->
     <ul class="navbar-nav">
         <li class="nav-item">
             <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
         </li>
         {{-- <li class="nav-item d-none d-sm-inline-block">
        <a href="../../index3.html" class="nav-link">Home</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">Contact</a>
      </li> --}}
     </ul>

     <!-- Right navbar links -->
     <ul class="navbar-nav ml-auto">
         <!-- Navbar Search -->
         {{-- <li class="nav-item">
        <a class="nav-link" data-widget="navbar-search" href="#" role="button">
          <i class="fas fa-search"></i>
        </a>
        <div class="navbar-search-block">
          <form class="form-inline">
            <div class="input-group input-group-sm">
              <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
              <div class="input-group-append">
                <button class="btn btn-navbar" type="submit">
                  <i class="fas fa-search"></i>
                </button>
                <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </form>
        </div>
      </li> --}}

         <!-- Messages Dropdown Menu -->
         {{-- <li class="nav-item dropdown">
        <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="far fa-comments"></i>
          <span class="badge badge-danger navbar-badge">3</span>
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          <a href="#" class="dropdown-item">
            <!-- Message Start -->
            <div class="media">
              <img src="{{ asset('assets/view/adminlte/dist/img/user1-128x128.png') }}" alt="User Avatar" class="img-size-50 mr-3 img-circle">
              <div class="media-body">
                <h3 class="dropdown-item-title">
                  Brad Diesel
                  <span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>
                </h3>
                <p class="text-sm">Call me whenever you can...</p>
                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
              </div>
            </div>
            <!-- Message End -->
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <!-- Message Start -->
            <div class="media">
              <img src="{{ asset('assets/view/adminlte/dist/img/user8-128x128.png') }}" alt="User Avatar" class="img-size-50 img-circle mr-3">
              <div class="media-body">
                <h3 class="dropdown-item-title">
                  John Pierce
                  <span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>
                </h3>
                <p class="text-sm">I got your message bro</p>
                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
              </div>
            </div>
            <!-- Message End -->
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <!-- Message Start -->
            <div class="media">
              <img src="{{ asset('assets/view/adminlte/dist/img/user3-128x128.png') }}" alt="User Avatar" class="img-size-50 img-circle mr-3">
              <div class="media-body">
                <h3 class="dropdown-item-title">
                  Nora Silvester
                  <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
                </h3>
                <p class="text-sm">The subject goes here</p>
                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
              </div>
            </div>
            <!-- Message End -->
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item dropdown-footer">See All Messages</a>
        </div>
      </li> --}}

         <!-- Notifications Dropdown Menu -->
         <li class="nav-item dropdown user-menu">
             <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
                 <img src="{{ isset(\Auth::user()->avatar) ? asset(\Auth::user()->avatar) : asset('storage/photos/shares/avatars/default-profile.jpg') }}"
                     class="user-image img-circle elevation-2" alt="User Image">
                 <span class="d-none d-md-inline">{{ isset(\Auth::user()->name) ? \Auth::user()->name : '' }}</span>
             </a>
             <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                 <!-- User image -->
                 <li class="user-header bg-primary">
                     <img src="{{ isset(\Auth::user()->avatar) ? asset(\Auth::user()->avatar) : asset('storage/photos/shares/avatars/default-profile.jpg') }}"
                         class="img-circle elevation-2" alt="User Image">
                     <p>
                        {{ isset(\Auth::user()->name) ? \Auth::user()->name : '' }}
                         {{-- <small>Member since Nov. 2012</small> --}}
                     </p>
                 </li>
                 <!-- Menu Body -->
                 {{-- <li class="user-body">
                    <div class="row">
                    <div class="col-4 text-center">
                        <a href="#">Followers</a>
                    </div>
                    <div class="col-4 text-center">
                        <a href="#">Sales</a>
                    </div>
                    <div class="col-4 text-center">
                        <a href="#">Friends</a>
                    </div>
                    </div>
                    <!-- /.row -->
                </li> --}}
                 <!-- Menu Footer-->
                 <li class="user-footer">
                     <a href="{{route('personnel.user.profile')}}" class="btn btn-default btn-flat">Hồ sơ</a>
                     <a href="{{ route('recruitment.user.logout') }}" class="btn btn-default btn-flat float-right">Đăng
                         xuất</a>
                 </li>
             </ul>
         </li>
         <li class="nav-item dropdown">
             <a class="nav-link" data-toggle="dropdown" href="#">
                 <i class="far fa-bell"></i>
                 <span class="badge badge-danger navbar-badge">0</span>
             </a>
             <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right notification"
                 style="overflow: scroll; max-height:500px;">
                 <span class="dropdown-item dropdown-header">0 Thông báo</span>
                 <div class="dropdown-divider"></div>
                 {{-- <a href="#" class="dropdown-item">
                     <i class="fas fa-envelope mr-2"></i> 4 new messages
                     <span class="float-right text-muted text-sm">3 mins</span>
                 </a>
                 <div class="dropdown-divider"></div> --}}
                 <div class="dropdown-divider"></div>
                 <a href="#" class="dropdown-item dropdown-footer">Tất cả thông báo</a>
             </div>
         </li>
         <li class="nav-item">
             <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                 <i class="fas fa-expand-arrows-alt"></i>
             </a>
         </li>
         {{-- <li class="nav-item">
        <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
          <i class="fas fa-th-large"></i>
        </a>
      </li> --}}
     </ul>
 </nav>



 <script>
     $(document).ready(function() {
         fetchNotifications()

         function fetchNotifications() {
             $.ajax({
                 url: '/api/recruitment/notification',
                 method: 'GET',
                 success: function(resp) {
                     let data = resp.data;
                     let notificationList = $(
                         ".dropdown-menu.dropdown-menu-lg.dropdown-menu-right.notification");
                     notificationList.empty(); // Xóa danh sách thông báo cũ

                     // Cập nhật số thông báo
                     $(".badge-danger.navbar-badge").text(data.length);

                     // Thêm tiêu đề thông báo
                     notificationList.append(
                         '<div class = "container"' +
                         '<div class = "row">' +
                         '<a href="/notification" class="dropdown-item dropdown-header col-sm-6 text-primary">Đánh dấu đã đọc</a>' +
                         '<a href="/notification" class="dropdown-item dropdown-header col-sm-6 text-primary">Xem tất cả</a>' +
                         '</div>' +
                         '</div>'
                     );
                     notificationList.append('<div class="dropdown-divider"></div>');

                     // Lặp qua các thông báo và thêm vào danh sách
                     data.forEach(function(notification) {

                         let parsedData = JSON.parse(notification.data);
                         //  console.log(parsedData.message);

                         let notificationItem = '<b class="pl-3 mt-2">' + parsedData.title +
                             ' </b>' + '<a href="' + notification.link +
                             '" class="dropdown-item">' +
                             parsedData.message +
                             '</a>' +
                             '<span class="pl-3 text-muted text-sm">' + notification
                             .created_at + '</span>' +
                             '<div class="dropdown-divider"></div>';

                         notificationList.append(notificationItem);
                     });

                     // Thêm liên kết xem tất cả thông báo
                     notificationList.append(
                         '<a href="#" class="dropdown-item dropdown-footer">Tất cả thông báo</a>'
                     );
                 }

                 //  success: function(data) {
                 //      let unreadCount = 0;
                 //      data.forEach(function(notification) {
                 //          let isRead = notification.read_ats

                 //          if (!isRead) unreadCount++;

                 //          // Tạo một mục thông báo
                 //          let notificationItem = `
                //     <a href="${notification.link}" class="dropdown-item ${isRead ? 'text-muted' : ''}">
                //         <i class="fas fa-envelope mr-2"></i> ${notification.message}
                //         <span class="float-right text-muted text-sm">${moment(notification.created_at).fromNow()}</span>
                //     </a>
                //     <div class="dropdown-divider"></div>
                // `;

                 //          // Thêm vào menu
                 //          $('.dropdown-menu').prepend(notificationItem);
                 //      });

                 //      // Cập nhật số thông báo chưa đọc
                 //      $('.navbar-badge').text(unreadCount);
                 //      $('.dropdown-header').text(unreadCount + " Notifications");
                 //  },
             });
         }

         // Gọi hàm mỗi 30 giây
         //setInterval(fetchNotifications, 30000);
     });
 </script>
 <style>
     .dropdown-item {
         white-space: collapse !important;
     }

     .dropdown-menu-lg {
         max-width: 330px !important;
         min-width: 350px !important;
         padding: 0;
     }

     .dropdown-menu-lg .dropdown-item {
         padding: 0rem 1rem !important;
     }
 </style>
 <!-- /.navbar -->

================
File: resources/views/plc/layouts/_sidebar.blade.php
================
<!-- Main Sidebar Container -->
<aside class="main-sidebar main-sidebar-custom sidebar-dark-success elevation-4">
    <!-- Brand Logo -->
    <a href="{{route('module.index')}}" class="brand-link">
        <img src="data:image/png;base64,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"
            alt="Logo" class="brand-image img-circle elevation-3" style="opacity: .8; margin-left:0px !important">
        <span class="brand-text font-weight-light">Quản lý PLC</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
        <!-- SidebarSearch Form -->
        <div class="form-inline mt-1">
            <div class="input-group" data-widget="sidebar-search">
                <input class="form-control form-control-sidebar" type="search" placeholder="Search"
                    aria-label="Search">
                <div class="input-group-append">
                    <button class="btn btn-sidebar">
                        <i class="fas fa-search fa-fw"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
            <ul class="nav nav-pills nav-sidebar flex-column text-sm" data-widget="treeview" role="menu"
                data-accordion="false">
                <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
                <li class="nav-item">
                    <a href="{{ route('plc.index') }}" class="nav-link">
                        <i class="nav-icon fas fa-home"></i>
                        <p>
                            Trang chủ
                        </p>
                    </a>
                </li>
                <li class="nav-header">Quản lý máy</li>
                <li class="nav-item">
                    <a href="{{ route('plc.machine.index') }}" class="nav-link">
                        <i class="fa fa-user nav-icon"  aria-hidden="true"></i>
                        <p>Danh sách máy</p>
                    </a>
                </li>
                {{-- <li class="nav-item">
                    <a href="" class="nav-link">
                        <i class="fa fa-calendar nav-icon" aria-hidden="true"></i>
                        <p>Cài đặt ngưỡng</p>
                    </a>
                </li> --}}
                <li class="nav-item">
                    <a href="" class="nav-link">
                        <i class="fa fa-calendar nav-icon" aria-hidden="true"></i>
                        <p>Cài đặt thông báo</p>
                    </a>
                </li>


                {{-- <li class="nav-item">
                    <a href="{{ route('recruitment.source.index') }}" class="nav-link">
                        <i class="fa fa-share-alt nav-icon" aria-hidden="true"></i>
                        <p>Nguồn ứng tuyển</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ route('recruitment.annual_employee.index') }}" class="nav-link">
                        <i class="fas fa-users-cog nav-icon"></i>
                        <p>Định biên nhân sự</p>
                    </a>
                </li>

                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fa fa-file nav-icon" aria-hidden="true"></i>
                        <p>
                            Thống kê báo cáo
                            <i class="fas fa-angle-left right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{{ route('recruitment.report.recruitment.index') }}" class="nav-link">
                                <i class="far fa-circle nav-icon"></i>
                                <p>Kế hoạch tuyển dụng </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ route('recruitment.report.recruitment.recruitmentKpi') }}" class="nav-link">
                                <i class="far fa-circle nav-icon"></i>
                                <p>Kpi nhân sự HR </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ route('recruitment.report.recruitment.candidate') }}" class="nav-link">
                                <i class="far fa-circle nav-icon"></i>
                                <p>Danh sách nhận việc</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ route('recruitment.report.recruitment.convertRate') }}" class="nav-link">
                                <i class="far fa-circle nav-icon"></i>
                                <p>Tỷ lệ chuyển đổi</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ route('recruitment.report.recruitment.candidateSource') }}" class="nav-link">
                                <i class="far fa-circle nav-icon"></i>
                                <p>Ứng viên theo nguồn tuyển dụng</p>
                            </a>
                        </li>
                    </ul> --}}


            </ul>
        </nav>
        <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->

    <div class="sidebar-custom">
        <a href="#" class="btn btn-link"><i class="fas fa-cogs"></i></a>
        <a href="#" class="btn btn-secondary hide-on-collapse pos-right">Help</a>
    </div>
    <!-- /.sidebar-custom -->
</aside>

================
File: resources/views/plc/layouts/master_candidate.blade.php
================
<!DOCTYPE html>
<html lang="vi">

<head>
    @include('recruitment/layouts/_head')
</head>

<body class="old-transition sidebar-mini sidebar-collapse layout-fixed">

    <!-- Main content -->

    <!-- header -->
    {{-- @include('recruitment/layouts/_header') --}}
    <!-- Page content -->
    <section class="content">
        <div class="container">

            @if (session('error'))
            <div class="alert alert-danger alert-dismissible session-notify">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>{{ session('error') }}</strong>
            </div>
            @elseif (session('success'))
            <div class="alert alert-success alert-dismissible session-notify">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>{{ session('success') }}</strong>
            </div>
            @endif
            @yield('content')
        </div>
    </section>

    <!-- Footer -->
    @include('recruitment/layouts/_footer')

</body>
@yield('script')

</html>

================
File: resources/views/plc/layouts/master_content.blade.php
================
<!DOCTYPE html>
<html lang="en">
<head>
    @include('recruitment/layouts/_head')
</head>

<body class="hold-transition login-page">

    @yield('content')

</body>
@yield('script')
</html>

================
File: resources/views/plc/layouts/master.blade.php
================
<!DOCTYPE html>
<html lang="vi">

<head>
    @include('plc/layouts/_head')
</head>

<body class="old-transition sidebar-mini sidebar-collapse layout-fixed">
    <div class="wrapper">

        <!-- navbar -->
        @include('plc/layouts/_navbar')
        <!-- sidebar -->
        @include('plc/layouts/_sidebar')
        <!-- Main content -->
        <div class="content-wrapper">
            <!-- header -->
            @include('plc/layouts/_header')
            <!-- Page content -->
            <section class="content">
                <div class="container-fluid">

                    @if (session('error'))
                        <div class="alert alert-danger alert-dismissible session-notify">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>{{ session('error') }}</strong>
                        </div>
                    @elseif (session('success'))
                        <div class="alert alert-success alert-dismissible session-notify">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>{{ session('success') }}</strong>
                        </div>
                    @endif
                    @yield('content')
                </div>
            </section>
        </div>
        <!-- Footer -->
        @include('plc/layouts/_footer')
    </div>
</body>
@yield('script')

</html>

================
File: resources/views/plc/machine/create.blade.php
================
{{-- views/plc/machine/create.blade.php --}}
@extends('plc.layouts.master')
@section('content')
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Thêm máy mới</h3>
    </div>

    <div class="card-body">
        @if($errors->any())
            <div class="alert alert-danger">
                <ul class="mb-0">
                    @foreach($errors->all() as $error)
                        <li>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <form action="{{ route('plc.machine.store') }}" method="POST">
            @csrf

            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Tên máy <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" name="name" value="{{ old('name') }}" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Mã máy <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" name="code" value="{{ old('code') }}" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Địa chỉ IP <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" name="ip_address" value="{{ old('ip_address') }}" required>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Mô tả</label>
                <textarea class="form-control" name="description" rows="3">{{ old('description') }}</textarea>
            </div>

            <div class="form-group">
                <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" name="status" value="1" id="status" checked>
                    <label class="custom-control-label" for="status">Kích hoạt</label>
                </div>
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Lưu
                </button>
                <a href="{{ route('plc.machine.index') }}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Hủy
                </a>
            </div>
        </form>
    </div>
</div>
@stop

================
File: resources/views/plc/machine/edit.blade.php
================
@extends('plc.layouts.master')
@section('content')
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Cập nhật máy</h3>
    </div>

    <div class="card-body">
        @if($errors->any())
            <div class="alert alert-danger">
                <ul class="mb-0">
                    @foreach($errors->all() as $error)
                        <li>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <form action="{{ route('plc.machine.update', $machine->id) }}" method="POST">
            @csrf
            @method('POST')

            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Tên máy <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" name="name"
                               value="{{ old('name', $machine->name) }}" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Mã máy <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" name="code"
                               value="{{ old('code', $machine->code) }}" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Địa chỉ IP <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" name="ip_address"
                               value="{{ old('ip_address', $machine->ip_address) }}" required>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Mô tả</label>
                <textarea class="form-control" name="description" rows="3">{{ old('description', $machine->description) }}</textarea>
            </div>

            <div class="form-group">
                <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" name="status" value="1"
                           id="status" {{ $machine->status ? 'checked' : '' }}>
                    <label class="custom-control-label" for="status">Kích hoạt</label>
                </div>
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Cập nhật
                </button>
                <a href="{{ route('plc.machine.index') }}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Hủy
                </a>
            </div>
        </form>
    </div>
</div>
@stop

================
File: resources/views/plc/machine/index.blade.php
================
@extends('plc.layouts.master')
@section('content')
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Danh sách máy</h3>
        <div class="card-tools">
            <a href="{{ route('plc.machine.create') }}" class="btn btn-primary btn-sm">
                <i class="fas fa-plus"></i> Thêm máy
            </a>
        </div>
    </div>

    <div class="card-body">
        @if(session('success'))
            <div class="alert alert-success">{{ session('success') }}</div>
        @endif

        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Tên máy</th>
                        <th>Mã máy</th>
                        <th>Địa chỉ IP</th>
                        <th>Mô tả</th>
                        <th>Trạng thái</th>
                        <th>Cài đặt cảnh báo</th>
                        <th style="width: 100px">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @forelse($machines as $machine)
                    <tr>
                        <td>{{ $machine->name }}</td>
                        <td>{{ $machine->code }}</td>
                        <td>{{ $machine->ip_address }}</td>
                        <td>{{ $machine->description }}</td>
                        <td class="text-center">
                            <form action="{{ route('plc.machine.toggle-status', $machine->id) }}"
                                  method="POST" class="d-inline">
                                @csrf
                                <button type="submit" class="btn btn-{{ $machine->status ? 'success' : 'secondary' }} btn-sm">
                                    {{ $machine->status ? 'Đang hoạt động' : 'Tạm dừng' }}
                                </button>
                            </form>
                        </td>
                        <td class="text-center">
                            <a href="{{ route('plc.machine.thresholds.show', $machine->id) }}"
                               class="btn btn-info btn-sm">
                                <i class="fas fa-cog"></i> Cài đặt
                            </a>
                        </td>
                        <td class="text-center">
                            <a href="{{ route('plc.machine.edit', $machine->id) }}"
                               class="btn btn-warning btn-xs">
                                <i class="fas fa-edit"></i>
                            </a>
                            <form action="{{ route('plc.machine.destroy', $machine->id) }}"
                                  method="POST" class="d-inline-block">
                                @csrf
                                @method('DELETE')
                                <button type="submit" class="btn btn-danger btn-xs delete-confirm">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    @empty
                    <tr>
                        <td colspan="7" class="text-center">Chưa có máy nào được thêm</td>
                    </tr>
                    @endforelse
                </tbody>
            </table>
        </div>
    </div>
</div>

@push('scripts')
<script>
$(function() {
    $('.delete-confirm').click(function(e) {
        e.preventDefault();
        if (confirm('Bạn có chắc muốn xóa máy này?')) {
            $(this).closest('form').submit();
        }
    });
});
</script>
@endpush
@stop

================
File: resources/views/plc/machine_threshold/create.blade.php
================
@extends('plc.layouts.master')
@section('content')
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Thêm cảnh báo mới</h3>
    </div>

    <div class="card-body">
        @if($errors->any())
            <div class="alert alert-danger">
                <ul class="mb-0">
                    @foreach($errors->all() as $error)
                        <li>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <form action="{{ route('plc.machine.thresholds.store') }}" method="POST">
            @csrf
            <input type="hidden" name="machine_id" value="{{ $machine->id }}">

            <div class="form-group">
                <label>Tag PLC <span class="text-danger">*</span></label>
                <select name="plc_data_key" class="form-control" required>
                    <option value="">Chọn tag</option>
                    @foreach($availableColumns as $column)
                        <option value="{{ $column }}" {{ old('plc_data_key') == $column ? 'selected' : '' }}>
                            {{ $column }}
                        </option>
                    @endforeach
                </select>
            </div>

            <div class="form-group">
                <label>Tên hiển thị <span class="text-danger">*</span></label>
                <input type="text" name="name" class="form-control" value="{{ old('name') }}" required>
            </div>

            <div class="form-group">
                <label>Loại cảnh báo <span class="text-danger">*</span></label>
                <select name="type" class="form-control" required onchange="toggleTypeInputs(this.value)">
                    <option value="boolean" {{ old('type') == 'boolean' ? 'selected' : '' }}>True/False</option>
                    <option value="parameter" {{ old('type') == 'parameter' ? 'selected' : '' }}>Tham số</option>
                </select>
            </div>

            <div id="boolean_inputs" {{ old('type', 'boolean') == 'parameter' ? 'style=display:none' : '' }}>
                <div class="form-group">
                    <label>Giá trị cảnh báo</label>
                    <select name="value" class="form-control">
                        <option value="0" {{ old('value') == '0' ? 'selected' : '' }}>False (0)</option>
                        <option value="1" {{ old('value') == '1' ? 'selected' : '' }}>True (1)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Nội dung cảnh báo</label>
                    <input type="text" name="warning_message" class="form-control" value="{{ old('warning_message') }}">
                </div>
            </div>

            <div id="parameter_inputs" {{ old('type', 'boolean') == 'boolean' ? 'style=display:none' : '' }}>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Giới hạn dưới</label>
                            <input type="number" step="0.01" name="min_value"
                                   class="form-control" value="{{ old('min_value') }}">
                        </div>
                        <div class="form-group">
                            <label>Cảnh báo dưới ngưỡng</label>
                            <input type="text" name="warning_min_value"
                                   class="form-control" value="{{ old('warning_min_value') }}">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Giới hạn trên</label>
                            <input type="number" step="0.01" name="max_value"
                                   class="form-control" value="{{ old('max_value') }}">
                        </div>
                        <div class="form-group">
                            <label>Cảnh báo trên ngưỡng</label>
                            <input type="text" name="warning_max_value"
                                   class="form-control" value="{{ old('warning_max_value') }}">
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" name="show_on_chart"
                           id="show_on_chart" value="1" {{ old('show_on_chart') ? 'checked' : '' }}>
                    <label class="custom-control-label" for="show_on_chart">Hiển thị trên biểu đồ</label>
                </div>
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Lưu
                </button>
                <a href="{{ route('plc.machine.thresholds.show', $machine->id) }}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Hủy
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function toggleTypeInputs(type) {
    if(type === 'boolean') {
        $('#boolean_inputs').show();
        $('#parameter_inputs').hide();
    } else {
        $('#boolean_inputs').hide();
        $('#parameter_inputs').show();
    }
}
</script>
@stop

================
File: resources/views/plc/machine_threshold/edit.blade.php
================
@extends('plc.layouts.master')
@section('content')
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Chỉnh sửa cảnh báo</h3>
    </div>

    <div class="card-body">
        @if($errors->any())
            <div class="alert alert-danger">
                <ul class="mb-0">
                    @foreach($errors->all() as $error)
                        <li>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <form action="{{ route('plc.machine.thresholds.update', $threshold->id) }}" method="POST">
            @csrf
            <input type="hidden" name="machine_id" value="{{ $threshold->machine_id }}">

            <div class="form-group">
                <label>Tag PLC <span class="text-danger">*</span></label>
                <select name="plc_data_key" class="form-control" required>
                    <option value="">Chọn tag</option>
                    @foreach($availableColumns as $column)
                        <option value="{{ $column }}" {{ old('plc_data_key', $threshold->plc_data_key) == $column ? 'selected' : '' }}>
                            {{ $column }}
                        </option>
                    @endforeach
                </select>
            </div>

            <div class="form-group">
                <label>Tên hiển thị <span class="text-danger">*</span></label>
                <input type="text" name="name" class="form-control"
                       value="{{ old('name', $threshold->name) }}" required>
            </div>

            <div class="form-group">
                <label>Loại cảnh báo <span class="text-danger">*</span></label>
                <select name="type" class="form-control" required onchange="toggleTypeInputs(this.value)">
                    <option value="boolean" {{ old('type', $threshold->type) == 'boolean' ? 'selected' : '' }}>True/False</option>
                    <option value="parameter" {{ old('type', $threshold->type) == 'parameter' ? 'selected' : '' }}>Tham số</option>
                </select>
            </div>

            <div id="boolean_inputs" {{ old('type', $threshold->type) == 'parameter' ? 'style=display:none' : '' }}>
                <div class="form-group">
                    <label>Giá trị cảnh báo</label>
                    <select name="value" class="form-control">
                        <option value="0" {{ old('value', $threshold->value) == '0' ? 'selected' : '' }}>False (0)</option>
                        <option value="1" {{ old('value', $threshold->value) == '1' ? 'selected' : '' }}>True (1)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Nội dung cảnh báo</label>
                    <input type="text" name="warning_message" class="form-control"
                           value="{{ old('warning_message', $threshold->warning_message) }}">
                </div>
            </div>

            <div id="parameter_inputs" {{ old('type', $threshold->type) == 'boolean' ? 'style=display:none' : '' }}>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Giới hạn dưới</label>
                            <input type="number" step="0.01" name="min_value" class="form-control"
                                   value="{{ old('min_value', $threshold->min_value) }}">
                        </div>
                        <div class="form-group">
                            <label>Cảnh báo dưới ngưỡng</label>
                            <input type="text" name="warning_min_value" class="form-control"
                                   value="{{ old('warning_min_value', $threshold->warning_min_value) }}">
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Giới hạn trên</label>
                                        <input type="number" step="0.01" name="max_value" class="form-control"
                                               value="{{ old('max_value', $threshold->max_value) }}">
                                    </div>
                                    <div class="form-group">
                                        <label>Cảnh báo trên ngưỡng</label>
                                        <input type="text" name="warning_max_value" class="form-control"
                                               value="{{ old('warning_max_value', $threshold->warning_max_value) }}">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" name="show_on_chart"
                                       id="show_on_chart" value="1"
                                       {{ old('show_on_chart', $threshold->show_on_chart) ? 'checked' : '' }}>
                                <label class="custom-control-label" for="show_on_chart">Hiển thị trên biểu đồ</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" name="status"
                                       id="status" value="1"
                                       {{ old('status', $threshold->status) ? 'checked' : '' }}>
                                <label class="custom-control-label" for="status">Kích hoạt</label>
                            </div>
                        </div>

                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Cập nhật
                            </button>
                            <a href="{{ route('plc.machine.thresholds.show', $threshold->machine_id) }}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Hủy
                            </a>
                        </div>
                    </form>
                </div>
            </div>


            <script>
            function toggleTypeInputs(type) {
                if(type === 'boolean') {
                    $('#boolean_inputs').show();
                    $('#parameter_inputs').hide();
                } else {
                    $('#boolean_inputs').hide();
                    $('#parameter_inputs').show();
                }
            }
            </script>

@stop

================
File: resources/views/plc/machine_threshold/index.blade.php
================
{{-- views/plc/machine_threshold/index.blade.php --}}
@extends('admin.layouts.master')
@section('content')
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Cài đặt cảnh báo - {{ $machine->name }}</h3>
        <div class="card-tools">
            <a href="{{ route('plc.machine.thresholds.create', $machine->id) }}" class="btn btn-primary btn-sm">
                <i class="fas fa-plus"></i> Thêm cài đặt
            </a>
        </div>
    </div>

    <div class="card-body">
        @if(session('success'))
            <div class="alert alert-success">{{ session('success') }}</div>
        @endif

        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Thông số</th>
                        <th>Giới hạn dưới</th>
                        <th>Cảnh báo dưới</th>
                        <th>Cảnh báo trên</th>
                        <th>Giới hạn trên</th>
                        <th>Hiển thị biểu đồ</th>
                        <th>Trạng thái</th>
                        <th style="width: 100px">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @forelse($thresholds as $threshold)
                    <tr>
                        <td>{{ $threshold->plc_data_key }}</td>
                        <td class="text-right">{{ number_format($threshold->min_value, 2) }}</td>
                        <td class="text-right">{{ number_format($threshold->warning_min_value, 2) }}</td>
                        <td class="text-right">{{ number_format($threshold->warning_max_value, 2) }}</td>
                        <td class="text-right">{{ number_format($threshold->max_value, 2) }}</td>
                        <td class="text-center">
                            <span class="badge badge-{{ $threshold->show_on_chart ? 'success' : 'secondary' }}">
                                {{ $threshold->show_on_chart ? 'Có' : 'Không' }}
                            </span>
                        </td>
                        <td class="text-center">
                            <span class="badge badge-{{ $threshold->is_active ? 'success' : 'secondary' }}">
                                {{ $threshold->is_active ? 'Đang kích hoạt' : 'Đã tắt' }}
                            </span>
                        </td>
                        <td class="text-center">
                            <a href="{{ route('plc.machine.thresholds.edit', $threshold->id) }}" class="btn btn-sm btn-info">
                                <i class="fas fa-edit"></i>
                            </a>
                            <form action="{{ route('plc.machine.thresholds.destroy', $threshold->id) }}"
                                  method="POST" class="d-inline-block">
                                @csrf
                                @method('DELETE')
                                <button type="submit" class="btn btn-danger btn-xs delete-confirm">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    @empty
                    <tr>
                        <td colspan="8" class="text-center">Chưa có cài đặt cảnh báo nào</td>
                    </tr>
                    @endforelse
                </tbody>
            </table>
        </div>
    </div>
</div>

@push('scripts')
<script>
$(function() {
    $('.delete-confirm').click(function(e) {
        e.preventDefault();
        if (confirm('Bạn có chắc muốn xóa cài đặt này?')) {
            $(this).closest('form').submit();
        }
    });
});
</script>
@endpush
@stop

================
File: resources/views/plc/machine_threshold/show.blade.php
================
@extends('plc.layouts.master')
@section('content')
<div class="card">
   <div class="card-header d-flex justify-content-between align-items-center">
       <h3 class="card-title">Cài đặt cảnh báo - {{ $machine->name }}</h3>
       <a href="{{ route('plc.machine.thresholds.create', $machine->id) }}" class="btn btn-primary">
           <i class="fas fa-plus"></i> Thêm cảnh báo
       </a>
   </div>

   <div class="card-body">
       <div class="table-responsive">
           <table class="table table-bordered">
               <thead>
                   <tr>
                       <th>Tên thông số</th>
                       <th>Tag PLC</th>
                       <th>Loại</th>
                       <th>Giá trị cảnh báo</th>
                       <th>Nội dung cảnh báo</th>
                       <th>Giới hạn dưới</th>
                       <th>Cảnh báo dưới</th>
                       <th>Cảnh báo trên</th>
                       <th>Giới hạn trên</th>
                       <th>Hiển thị đồ thị</th>
                       <th>Trạng thái</th>
                       <th>Thao tác</th>
                   </tr>
               </thead>
               <tbody>
                   @foreach($thresholds as $threshold)
                   <tr>
                       <td>{{ $threshold->name }}</td>
                       <td>{{ $threshold->plc_data_key }}</td>
                       <td>{{ $threshold->type === 'boolean' ? 'True/False' : 'Tham số' }}</td>
                       <td>{{ $threshold->type === 'boolean' ? $threshold->value : '' }}</td>
                       <td>{{ $threshold->type === 'boolean' ? $threshold->warning_message : '' }}</td>
                       <td>{{ $threshold->type === 'parameter' ? $threshold->min_value : '' }}</td>
                       <td>{{ $threshold->type === 'parameter' ? $threshold->warning_min_value : '' }}</td>
                       <td>{{ $threshold->type === 'parameter' ? $threshold->warning_max_value : '' }}</td>
                       <td>{{ $threshold->type === 'parameter' ? $threshold->max_value : '' }}</td>
                       <td class="text-center">
                           <div class="custom-control custom-switch">
                               <input type="checkbox" class="custom-control-input"
                                   id="chart_{{ $threshold->id }}"
                                   {{ $threshold->show_on_chart ? 'checked' : '' }}
                                   onchange="toggleChart({{ $threshold->id }})">
                               <label class="custom-control-label" for="chart_{{ $threshold->id }}"></label>
                           </div>
                       </td>
                       <td class="text-center">
                           <div class="custom-control custom-switch">
                               <input type="checkbox" class="custom-control-input"
                                   id="status_{{ $threshold->id }}"
                                   {{ $threshold->status ? 'checked' : '' }}
                                   onchange="toggleStatus({{ $threshold->id }})">
                               <label class="custom-control-label" for="status_{{ $threshold->id }}"></label>
                           </div>
                       </td>
                       <td class="text-center">
                        <a href="{{ route('plc.machine.thresholds.edit', ['id' => $threshold->id]) }}"
                            class="btn btn-sm btn-info">
                             <i class="fas fa-edit"></i>
                         </a>
                           <form action="{{ route('plc.machine.thresholds.destroy', $threshold->id) }}"
                                 method="POST" class="d-inline">
                               @csrf
                               @method('DELETE')
                               <button type="submit" class="btn btn-sm btn-danger"
                                       onclick="return confirm('Bạn có chắc muốn xóa?')">
                                   <i class="fas fa-trash"></i>
                               </button>
                           </form>
                       </td>
                   </tr>
                   @endforeach
               </tbody>
           </table>
       </div>
   </div>
</div>

@push('scripts')
<script>
function toggleChart(id) {
   $.ajax({
       url: `/plc/machine/thresholds/${id}/toggle-chart`,
       method: 'PUT',
       headers: {
           'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
       },
       success: function() {
           // Success
       }
   });
}

function toggleStatus(id) {
   $.ajax({
       url: `/plc/machine/thresholds/${id}/toggle-status`,
       method: 'PUT',
       headers: {
           'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
       },
       success: function() {
           // Success
       }
   });
}
</script>
@endpush
@stop

================
File: resources/views/plc/index.blade.php
================
@extends('plc.layouts.master')
@section('content')

@stop

================
File: routes/plc/admin.php
================
<?php

use Illuminate\Support\Facades\Route;

Route::get('/index', ['as' => 'plc.index', 'uses' => 'Plc\PlcController@index']);

// Routes cho Machine
Route::get('/machine', ['as' => 'plc.machine.index', 'uses' => 'Plc\MachineController@index']);
Route::get('/machine/create', ['as' => 'plc.machine.create', 'uses' => 'Plc\MachineController@create']);
Route::post('/machine/store', ['as' => 'plc.machine.store', 'uses' => 'Plc\MachineController@store']);
Route::get('/machine/edit/{id}', ['as' => 'plc.machine.edit', 'uses' => 'Plc\MachineController@edit']);
Route::post('/machine/update/{id}', ['as' => 'plc.machine.update', 'uses' => 'Plc\MachineController@update']);
Route::delete('/machine/destroy/{id}', ['as' => 'plc.machine.destroy', 'uses' => 'Plc\MachineController@destroy']);
Route::post('/machine/toggle-status/{id}', ['as' => 'plc.machine.toggle-status', 'uses' => 'Plc\MachineController@toggleStatus']);

Route::get('machine/{machine_id}/thresholds', [
    'as' => 'plc.machine.thresholds.show',
    'uses' => 'Plc\MachineThresholdController@show'
]);

Route::get('machine/{machine_id}/thresholds/create', [
    'as' => 'plc.machine.thresholds.create',
    'uses' => 'Plc\MachineThresholdController@create'
]);

Route::post('machine/thresholds/store', [
    'as' => 'plc.machine.thresholds.store',
    'uses' => 'Plc\MachineThresholdController@store'
]);

Route::get('machine/thresholds/edit/{id}', [
    'as' => 'plc.machine.thresholds.edit',
    'uses' => 'Plc\MachineThresholdController@edit'
]);

Route::post('machine/thresholds/update/{id}', [
    'as' => 'plc.machine.thresholds.update',
    'uses' => 'Plc\MachineThresholdController@update'
]);

Route::delete('machine/thresholds/destroy/{id}', [
    'as' => 'plc.machine.thresholds.destroy',
    'uses' => 'Plc\MachineThresholdController@destroy'
]);

Route::post('machine/thresholds/{id}/toggle-chart', [
    'as' => 'plc.machine.thresholds.toggle-chart',
    'uses' => 'Plc\MachineThresholdController@toggleChart'
]);

Route::post('machine/thresholds/{id}/toggle-status', [
    'as' => 'plc.machine.thresholds.toggle-status',
    'uses' => 'Plc\MachineThresholdController@toggleStatus'
]);

Route::get('/chart/{machineId}', [
    'as' => 'plc.chart.show',
    'uses' => 'Plc\ChartController@show'
]);

Route::get('/chart/{machineId}/data', [
    'as' => 'plc.chart.data',
    'uses' => 'Plc\ChartController@getData'
]);

================
File: routes/admin.php
================
<?php

Route::get('/', ['as' => 'module.index', 'uses' => 'Module\ModuleController@index']);

================
File: routes/api.php
================
<?php

use Illuminate\Support\Facades\Route;

================
File: routes/channels.php
================
<?php

use Illuminate\Support\Facades\Broadcast;

/*
|--------------------------------------------------------------------------
| Broadcast Channels
|--------------------------------------------------------------------------
|
| Here you may register all of the event broadctextasting channels that your
| application supports. The given channel authorization callbacks are
| used to check if an authenticated user can listen to the channel.
|
*/

Broadcast::channel('App.Models.User.{id}', function ($user, $id) {
    return (int) $user->id === (int) $id;
});

================
File: routes/console.php
================
<?php

use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;

/*
|--------------------------------------------------------------------------
| Console Routes
|--------------------------------------------------------------------------
|
| This file is where you may define all of your Closure based console
| commands. Each Closure is bound to a command instance allowing a
| simple approach to interacting with each command's IO methods.
|
*/

Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');

================
File: routes/frontend.php
================
<?php

use Illuminate\Support\Facades\Route;

Route::get('/thong-tin-ung-vien/{token}', ['as' => 'frontend.candidate.getForm', 'uses' => 'Frontend\CandidateController@getForm']);
Route::post('/thong-tin-ung-vien/submit/{token}', ['as' => 'frontend.candidate.submitForm', 'uses' => 'Frontend\CandidateController@submitForm']);
Route::post('/thong-tin-ung-vien/update/{token}', ['as' => 'frontend.candidate.update', 'uses' => 'Frontend\CandidateController@update']);

================
File: routes/web.php
================
<?php

use Illuminate\Support\Facades\Route;

/*
|--------------------------------------------------------------------------
| Web Routes
|--------------------------------------------------------------------------
|
| Here is where you can register web routes for your application. These
| routes are loaded by the RouteServiceProvider and all of them will
| be assigned to the "web" middleware group. Make something great!
|
*/

// Route::get('/', function () {
//     return view('welcome');
// });

Route::group(['prefix' => 'laravel-filemanager', 'middleware' => ['web', 'unisharp']], function () {
    \UniSharp\LaravelFilemanager\Lfm::routes();
});

Route::get('/login', ['as' => 'auth.get_login', 'uses' => 'Auth\AuthController@getLogin']);
Route::post('/login', ['as' => 'auth.login', 'uses' => 'Auth\AuthController@login']);
Route::get('/forget-password', ['as' => 'auth.forget_password', 'uses' => 'Auth\AuthController@forgetPassword']);

//Ckfinder
Route::any('/ckfinder/connector', '\CKSource\CKFinderBridge\Controller\CKFinderController@requestAction')
    ->name('ckfinder_connector');
Route::any('/ckfinder/browser', '\CKSource\CKFinderBridge\Controller\CKFinderController@browserAction')
    ->name('ckfinder_browser');
//Route::post('/forget-password', ['as' => 'auth.forget_password', 'uses' => 'Auth\AuthController@ForgetPassword']);
